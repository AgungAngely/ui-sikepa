;/*FB_PKG_DELIM*/

__d("LSRemoveError",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.db.table(6).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("MAWCatQuery.graphql",["cr:11203"],(function(a,b,c,d,e,f){"use strict";e.exports=b("cr:11203")}),null);
__d("MAWCatQuery",["MAWCatQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h!==void 0?h:h=b("MAWCatQuery.graphql");c=a;g["default"]=c}),98);
__d("MAWCryptoAuthToken",["MAWCatQuery","RelayHooks","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a==null||a.secure_message_over_wa_cat_query==null||a.secure_message_over_wa_cat_query.encrypted_serialized_cat==null||a.secure_message_over_wa_cat_query.expiration_time_in_seconds==null?{error:"Crypto Auth Token was null or incomplete"}:{success:{encrypted_serialized_cat:a.secure_message_over_wa_cat_query.encrypted_serialized_cat,expiration_time_in_seconds:a.secure_message_over_wa_cat_query.expiration_time_in_seconds}}}function a(a){return d("RelayHooks").fetchQuery(a,c("MAWCatQuery"),{}).toPromise().then(h).then(function(a){if(a.error!==null&&a.error!==void 0)throw c("err")("Unable to rotate Crypto Auth Token");return a.success})}g.processCatResponse=h;g.fetchFreshCAT=a}),98);
__d("MessengerWaitForEvent",["Promise"],(function(a,b,c,d,e,f){function a(a,c,d){var e,f=d;return new(b("Promise"))(function(b){f?e=function(){f.apply(this,arguments)&&b.apply(this,arguments)}:e=b,a&&a.addEventListener&&a.addEventListener(c,e)})["finally"](function(){a&&a.removeEventListener&&a.removeEventListener(c,e)})}f.waitForEvent=a}),66);
__d("LocalStorageMutex",["MessengerWaitForEvent","Promise","QPLUserFlow","err","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=1e3;a=function(){function a(a){var b=this,d=a.mutexKey,e=a.localTakeoverKey,f=a.log,g=a.logError,h=a.getStorage,j=a.setItemGuarded,k=a.mutexTimeoutMs;k=k===void 0?i:k;a=a.mutexTimeoutCallback;this.mutexFilter=function(a){if(a.key!==b.$1)return!1;a=a.newValue||"";if(!a.includes(c("pageID")))return!0;else return!1};this.$1=d;this.$2=e;this.$5=h;this.$6=j;this.$3=f;this.$4=g;this.$7=k;this.$8=a}var e=a.prototype;e.init=function(){c("QPLUserFlow").start(c("qpl")._(1056847375,"584"));this.$3("APPMUTEX - this tab is "+c("pageID"));var a=this.getMutex();if(a!=null&&a===c("pageID")){this.$3("APPMUTEX - WE ALREADY HAVE THE MUTEX LOCK WITHIN INIT");c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return b("Promise").resolve(!0)}if(a!=null){this.$3("APPMUTEX - initiating localTAKEOVER");return this.localTakeover()}else{this.$3("APPMUTEX - NO1 ELSE IS ALIVE, GET THE MUTEX");a=this.$9(c("pageID"));var d=this.$10(c("pageID"));if(!a.success||!d.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{bool:{setMutexResult:d.success,setTakeoverResult:a.success},string:{setMutexError:d.error,setTakeoverError:a.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"fail_to_set_takeover_or_mutex");return b("Promise").resolve(!1)}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return b("Promise").resolve(!0)}};e.localTakeover=function(){var a,e=this,f=this.$9(c("pageID"));if(!f.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{initTakeoverError:f.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_init_takeover_failure");return b("Promise").resolve(!1)}var g,h=function(){g!=null&&clearTimeout(g)};f=d("MessengerWaitForEvent").waitForEvent(window,"storage",this.mutexFilter);var j=(a=this==null?void 0:this._mutexTimeoutMs)!=null?a:i;return b("Promise").race([f,new(b("Promise"))(function(a){g=setTimeout(function(){a()},j)}),this.$8?this.$8():new(b("Promise"))(function(a){})]).then(function(a){if(a==null){e.$3("AppMutex - Forcefully took the mutex and takeover lock");var b=e.$9(c("pageID")),d=e.$10(c("pageID"));if(!b.success||!d.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{setMutexError:d.error,setTakeoverError:b.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_forcefully_takeover_failure");return!1}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return!0}e.$3("APPMUTEX - GOT MUTEX STORAGE EVENT CHANGE FROM ANOTHER TAB");d=e.$11(a.newValue);if(!d&&e.hasTakeoverPermission()){e.$3("APPMUTEX - setting mutex on localtakeover");b=e.$10(c("pageID"));if(!b.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{setMutexError:b.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_set_mutex_failure");return!1}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return!0}else{e.hasTakeoverPermission()&&e.$12();c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_no_takeover_permission");return!1}}).then(function(a){h();return a})["catch"](function(a){h();e.$4("AppMutex - localTakeover error no permission - "+a);c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_general_failure");return!1})};e.onMutexDeath=function(){var a=this.getMutex();a!=null&&a==c("pageID")&&(this.$3("APPMUTEX - removing mutex on death"),this.$13(),this.hasTakeoverPermission()&&this.$12())};e.takeoverFilter=function(a){if(a.key!==this.$2)return!1;a=a.newValue||"";if(!a.includes(c("pageID")))return!0;else return!1};e.$14=function(){if(!h){var a=this.$5();if(!a)throw c("err")("Could not get localStorage");h=a}return h};e.getMutex=function(){h=this.$14();return h.getItem(this.$1)};e.$10=function(a){h=this.$14();return this.$6(h,this.$1,a)};e.$13=function(){h=this.$14(),h.removeItem(this.$1)};e.getTakeover=function(){h=this.$14();return h.getItem(this.$2)};e.$9=function(a){h=this.$14();a=this.$6(h,this.$2,a);return a};e.$12=function(){h=this.$14(),h.removeItem(this.$2)};e.$11=function(a){return a!=null?a:""};e.hasTakeoverPermission=function(){var a=this.getTakeover();return a!=null&&a==c("pageID")};return a}();g.THIS_TAB=c("pageID");g.LocalStorageMutex=a}),98);
__d("MAWAppMutex",["LocalStorageMutex","MAWLocalStorage","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h="armadillo_msgr_mutex",i="armadillo_msgr_local_takeover",j=null;function a(){j==null&&(j=new(d("LocalStorageMutex").LocalStorageMutex)({getStorage:d("MAWLocalStorage").getStorage,localTakeoverKey:i,log:function(a){d("WALogger").LOG([a])},logError:function(a){d("WALogger").ERROR([a])},mutexKey:h,setItemGuarded:d("MAWLocalStorage").setItemGuarded}));return j}g.MAW_MUTEX_KEY=h;g.MAW_LOCALTAKEOVER_KEY=i;g.use=a}),98);
__d("MAWLocalizationEphemeralSettingSetAdminMsg",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF}g.isEphemeralSettingSetAdminMsg=a}),98);
__d("MAWAdminMsgCTA",["fbt","I64","MAWLocalizationEphemeralSettingSetAdminMsg","MAWLocalizationType","MAWTimeUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i=h._("__JHASH__iw7A0LnsmaW__JHASH__").toString(),j=h._("__JHASH__jODYJ2eW1Pa__JHASH__").toString(),k=h._("__JHASH__xAOSvpC7vLN__JHASH__").toString();function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("admin_message_ctas").index("ctaId"))));return a!=null?d("I64").add(a.ctaId,d("I64").one):d("I64").zero});return m.apply(this,arguments)}function n(a,b,c){b={hd:b,tl:{hd:c,tl:0}};return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("admin_message_ctas")).bounds({gte:b,lte:b}))}function o(a){if(a==null)return{showAdChoiceIcon:!1};if(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(a))return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:i};switch(a){case d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:j};case d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:k};default:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:void 0}}}function p(a){if(a==null)return;if(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(a))return"admin_msg_armadillo_ephemeral_change_duration";switch(a){case d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE:return"admin_msg_thread_level_cutover";case d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION:return"admin_msg_e2ee_thread";case d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE:return"admin_msg_cutover_rollback"}}function q(a,b,c,e,f){return a.table("admin_message_ctas").add({actionUrl:f.actionUrl,adClientToken:f.adClientToken,adHelpUrl:f.adHelpUrl,adminMessageNicknameParticipantId:f.adminMessageNicknameParticipantId,adPreferenceUrl:f.adPreferenceUrl,ctaId:b,messageId:e.msgId,showAdChoiceIcon:f.showAdChoiceIcon,targetId:f.targetId,targetTitle:f.targetTitle,threadKey:c,timestampMs:d("MAWTimeUtils").toTimestamp(e.ts),title:f.title})}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){var e=(yield b("Promise").all([n(a,c,d.msgId),l(a)])),f=e[0];e=e[1];if(f!=null)return{ctaId:f.ctaId,ctaType:p(d.adminType),title:f.title};else{f=o(d.adminType);yield q(a,e,c,d,f);return{ctaId:e,ctaType:p(d.adminType),title:f.title}}});return s.apply(this,arguments)}function a(a,c,e){var f=e.adminType;return f!=null&&(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(f)||f===d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE||f===d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE||f===d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION||f===d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE)?r(a,c,e):b("Promise").resolve()}g.insertAdminMsgCta=q;g.createOrReturnExistingAdminMsgCta=r;g.getAdminMsgCtaStep=a}),98);
__d("MAWMedia",["I64","LSIntEnum","MAWDbMedia","MessagingAttachmentType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a===d("MAWDbMedia").IMAGE)return b!=null?d("LSIntEnum").ofNumber(c("MessagingAttachmentType").EPHEMERAL_IMAGE):d("LSIntEnum").ofNumber(c("MessagingAttachmentType").IMAGE);else if(a===d("MAWDbMedia").VIDEO)return b!=null?d("LSIntEnum").ofNumber(c("MessagingAttachmentType").EPHEMERAL_VIDEO):d("LSIntEnum").ofNumber(c("MessagingAttachmentType").VIDEO);else if(a===d("MAWDbMedia").PTT)return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").AUDIO);else if(a===d("MAWDbMedia").GIF)return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE);else if(a===d("MAWDbMedia").STICKER)return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").STICKER);else if(a===d("MAWDbMedia").DOCUMENT_FILE)return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").FILE);return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").NONE)}g.mediaTypeToMessageAttachmentType=a;g.mediaIdToIntExn=d("I64").of_int32}),98);
__d("getMAWLastMessageCtaType",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.snippetType;switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL:return"xma_rtc_missed_audio";case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL:return"xma_rtc_missed_group_audio";case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL:return"xma_rtc_missed_video";case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL:return"xma_rtc_missed_group_video"}}g["default"]=a}),98);
__d("MAWBridgeNewXMAHandler",["I64","LSIntEnum","MAWBridgeUIEventDataValidation","MAWDbMsg","MAWMiActOnMiThreadReadyForChatId","MNLSXMALayoutType","MNLSXMATemplateType","MNXMAPreviewImageDecorationType","MessagingAttachmentType","Promise","ReQL","WAArmadilloXMA.pb","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(a==null)return;a=a[b-1];if(a==null)return;return a.buttonType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE?"xma_open_native":void 0}function i(a,b){if(a==null)return;a=a[b-1];if(a!=null)return a.title}function j(a){return a===0||a!==3?d("LSIntEnum").ofNumber(c("MNLSXMALayoutType").SINGLE):d("LSIntEnum").ofNumber(c("MNLSXMALayoutType").PORTRAIT)}function a(a){return d("LSIntEnum").ofNumber(c("MNLSXMATemplateType").DEFAULT)}function k(a){switch(a){case 10:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").COLLAGE);case 14:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").REEL);case 5:case 6:case 7:case 8:case 9:case 11:case 15:case 16:case 17:case 18:case 19:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").DEFAULT);case 4:case 12:case 13:case 20:case 21:case 22:case 23:case 24:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").INSTAGRAM_ICON);default:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").DEFAULT)}}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=String(e.xmaId),l=e.msgId;if(l!=null){var m=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("attachment_ctas"))));m=m!=null?d("I64").add(m.ctaId,d("I64").one):d("I64").one;var n=e.defaultCTA;if(n!=null){var o=n.actionUrl,p=n.nativeUrl,q="xma_web_url";switch(e.targetType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:q="xma_rtc_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:q="xma_rtc_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:q="xma_rtc_missed_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:q="xma_rtc_missed_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:q="igd_web_post_share";break}var r=e.targetId!=null?d("MAWBridgeUIEventDataValidation").stringToI64Opt(e.targetId):void 0;yield a.table("attachment_ctas").add({actionContentBlob:void 0,actionUrl:o!=null?o:p,attachmentFbid:g,attachmentIndex:d("I64").zero,ctaId:m,enableExtensions:!1,extensionHeightType:void 0,messageId:l,nativeUrl:p!=null?p:o,platformToken:void 0,targetId:r,threadKey:f,title:(p=n.title)!=null?p:"",type_:q,urlWebviewType:void 0})}o=n==null?void 0:m;var s=m,t=[];r=e.ctas;if(r!=null){p=r.map(function(b,c){c=d("I64").add(s,d("I64").of_int32(c+1));t.push(c);var e=b.actionUrl,h=b.nativeUrl;return a.table("attachment_ctas").add({actionContentBlob:void 0,actionUrl:e!=null?e:h,attachmentFbid:g,attachmentIndex:d("I64").zero,ctaId:c,enableExtensions:!1,extensionHeightType:void 0,messageId:l,nativeUrl:h!=null?h:e,platformToken:void 0,targetId:void 0,threadKey:f,title:(c=b.title)!=null?c:"Tap to view status update",type_:"xma_web_url",urlWebviewType:void 0})});yield b("Promise").all(p)}q=d("I64").of_int32(d("MAWDbMsg").getInChatMsgIdFromMsgId(l));var u;switch(e.targetType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:u={height:d("I64").of_int32(108),width:d("I64").of_int32(72),xmaContentType:"xma_montage_share"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:u={xmaContentType:"xma_rtc_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:u={xmaContentType:"xma_rtc_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:u={xmaContentType:"xma_rtc_missed_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:u={xmaContentType:"xma_rtc_missed_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:u={xmaContentType:"xma_rtc_missed_group_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:u={xmaContentType:"xma_rtc_missed_group_video"};break;default:u={height:e.previewHeight!=null?d("I64").of_int32(e.previewHeight):void 0,width:e.previewWidth!=null?d("I64").of_int32(e.previewWidth):void 0,xmaContentType:"xma_web_url"};break}return a.table("attachments").add({accessibilitySummaryText:void 0,actionUrl:void 0,attachmentCta1Id:t.length>0?t[0]:void 0,attachmentCta2Id:t.length>1?t[1]:void 0,attachmentCta3Id:t.length>2?t[2]:void 0,attachmentFbid:g,attachmentIndex:d("I64").zero,attachmentLoggingType:void 0,attachmentType:d("LSIntEnum").ofNumber(c("MessagingAttachmentType").XMA),attributionAppIcon:void 0,attributionAppIconFallback:void 0,attributionAppIconUrlExpirationTimestampMs:void 0,attributionAppId:void 0,attributionAppName:void 0,authorityLevel:d("I64").zero,avatarCount:void 0,avatarViewAccessibilityLabel:void 0,avatarViewSize:void 0,avatarViewTitleList:void 0,avatarViewUrlExpirationTimestampList:void 0,avatarViewUrlFallbackList:void 0,avatarViewUrlList:void 0,captionBodyText:void 0,cta1Title:i(e.ctas,1),cta1Type:h(e.ctas,1),cta2Title:i(e.ctas,2),cta2Type:h(e.ctas,2),cta3Title:i(e.ctas,3),cta3Type:h(e.ctas,3),dashManifest:void 0,decryptionKey:void 0,defaultCtaId:o,defaultCtaTitle:(n=e.defaultCTA)==null?void 0:n.title,defaultCtaType:u.xmaContentType,descriptionText:void 0,ephemeralMediaState:void 0,faviconUrl:void 0,faviconUrlExpirationTimestampMs:void 0,faviconUrlFallback:void 0,filename:void 0,filesize:e.filesize!=null?d("I64").of_int32(e.filesize):void 0,gatingTitle:e.overlayTitle,gatingType:e.overlayIconGlyph!=null?String(e.overlayIconGlyph):void 0,hasMedia:!1,hasXma:!0,headerImageUrl:void 0,headerImageUrlExpirationTimestampMs:void 0,headerImageUrlFallback:void 0,headerImageUrlMimeType:void 0,headerTitle:e.headerTitle,imageUrl:void 0,imageUrlExpirationTimestampMs:void 0,imageUrlFallback:void 0,imageUrlMimeType:void 0,isBorderless:void 0,isPreviewImage:void 0,isSharable:!0,listItemAccessibilityText1:void 0,listItemAccessibilityText2:void 0,listItemAccessibilityText3:void 0,listItemContactUrlExpirationTimestampList1:void 0,listItemContactUrlExpirationTimestampList2:void 0,listItemContactUrlExpirationTimestampList3:void 0,listItemContactUrlFallbackList1:void 0,listItemContactUrlFallbackList2:void 0,listItemContactUrlFallbackList3:void 0,listItemContactUrlList1:void 0,listItemContactUrlList2:void 0,listItemContactUrlList3:void 0,listItemId1:void 0,listItemId2:void 0,listItemId3:void 0,listItemProfilePictureUrl1:void 0,listItemProfilePictureUrl2:void 0,listItemProfilePictureUrl3:void 0,listItemProfilePictureUrlExpirationTimestamp1:void 0,listItemProfilePictureUrlExpirationTimestamp2:void 0,listItemProfilePictureUrlExpirationTimestamp3:void 0,listItemProfilePictureUrlFallback1:void 0,listItemProfilePictureUrlFallback2:void 0,listItemProfilePictureUrlFallback3:void 0,listItemProgressBarFilledPercentage1:void 0,listItemProgressBarFilledPercentage2:void 0,listItemProgressBarFilledPercentage3:void 0,listItemsDescriptionSubtitleText:void 0,listItemsDescriptionText:void 0,listItemsId:void 0,listItemsSecondaryDescriptionText:void 0,listItemTitleText1:void 0,listItemTitleText2:void 0,listItemTitleText3:void 0,localPlayableUrl:void 0,maxSubtitleNumOfLines:e.maxSubtitleNumOfLines!=null?d("I64").of_int32(e.maxSubtitleNumOfLines):void 0,maxTitleNumOfLines:e.maxTitleNumOfLines!=null?d("I64").of_int32(e.maxTitleNumOfLines):void 0,messageId:l,miniPreview:void 0,offlineAttachmentId:(m=e.offlineAttachmentId)!=null?m:g,originalFileHash:void 0,originalPageSenderId:void 0,playableDurationMs:void 0,playableUrl:void 0,playableUrlExpirationTimestampMs:void 0,playableUrlFallback:void 0,playableUrlMimeType:void 0,preheaderText:void 0,previewHeight:u.height,previewHeightLarge:e.previewHeightLarge!=null?d("I64").of_int32(e.previewHeightLarge):void 0,previewImageDecorationType:k(e.targetType),previewUrl:void 0,previewUrlExpirationTimestampMs:void 0,previewUrlFallback:void 0,previewUrlLarge:void 0,previewUrlMimeType:void 0,previewWidth:u.width,previewWidthLarge:e.previewWidthLarge!=null?d("I64").of_int32(e.previewWidthLarge):void 0,samplingFrequencyHz:void 0,shouldAutoplayVideo:void 0,shouldHighlightHeaderTitleInTitle:void 0,shouldRespectServerPreviewSize:void 0,sourceText:void 0,subtitleIconUrl:void 0,subtitleText:e.subtitleText,targetId:void 0,threadKey:f,timestampMs:q,titleText:e.titleText,viewerSeenTimestampMs:void 0,waveformData:void 0,xmaLayoutType:e.xmaLayoutType!=null?j(e.xmaLayoutType):void 0,xmasTemplateType:e.xmaLayoutType!=null?j(e.xmaLayoutType):void 0})}});return m.apply(this,arguments)}function n(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeNewXMAHandler",function(a,c){return l(a,b,c)})}function e(a,b){return n(a,b)}g.getCTAType=h;g.getCTATitle=i;g.getLSXMALayoutType=j;g.getLSXMATemplateType=a;g.getLSPreviewImageDecorationType=k;g.call=e}),98);
__d("MAWBridgeDeleteGroupInviteHandler",["MAWMiActOnMiThreadReadyForChatId","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeDeleteGroupInviteHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("group_invites")).getKeyRange(c)));return b("Promise").all(c.map(function(b){return a.table("group_invites")["delete"]({hd:b.threadKey,tl:{hd:b.inviterId,tl:{hd:b.inviteeId,tl:0}}})})).then(function(){})});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeDeleteMessageRangesV2Handler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeDeleteMessageRangesV2Handler",function(a,c){return a.table("messages_ranges_v2__generated")["delete"]({hd:c,tl:{hd:d("I64").of_float(b.minTimestampMs),tl:{hd:b.minMsgId,tl:0}}})})}g.call=a}),98);
__d("MAWBridgeDeleteMessagesHandler",["MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeDeleteMessagesHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){for(var e of c.messages)yield a.table("messages")["delete"](d("ReQL").key(b,d("MAWTimeUtils").toTimestamp(e.ts),e.msgId))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeDeleteReactionHandler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeDeleteReactionHandler",function(a,c){return a.table("reactions")["delete"]({hd:c,tl:{hd:b.messageId,tl:{hd:d("I64").of_string(b.actorId),tl:0}}})})}g.call=a}),98);
__d("MAWBridgeGroupInfoUpdatedHandler",["MAWMiActOnMiThreadReadyForChatId","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInfoUpdatedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;e=(e=c.threadName)!=null?e:void 0;a=a.table("threads");b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b)));if(b==null)return;return a.put(babelHelpers["extends"]({},b,{threadName:e}))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeGroupInviteLoadedHandler",["fbt","I64","LSMessagingThreadTypeUtil","MAWMiActOnMiThreadReadyForChatId","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInviteLoadedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.table("threads"),f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e).getKeyRange(b)));if(f==null)return;var g=d("LSMessagingThreadTypeUtil").isGroup(f.threadType);if(!g)return;var i=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("group_invites")).getKeyRange(b)));if(i==null)return;g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("contacts")).filter(function(a){return!d("I64").equal(d("I64").of_string(c.actorId),i.inviterId)&&d("I64").equal(a.id,i.inviterId)})));if(g==null)return;b=h._("__JHASH__UJFQkCMRFkv__JHASH__",[h._param("Inviter Name",g.name)]).toString();a=f.folderName==="inbox"?h._("__JHASH__4F6x7gUU1-S__JHASH__").toString():f.additionalThreadContext;return e.put(babelHelpers["extends"]({},f,{additionalThreadContext:a,snippet:b}))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeGroupInviteUpdateHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInviteUpdateHandler",function(a,e){var f=d("I64").of_string(c.inviterId),g=a.table("group_invites");return b("Promise").all([g.put({caption:(g=c.caption)!=null?g:void 0,inviteCode:c.inviteCode,inviteeId:d("I64").of_string(c.inviteeId),inviteExpirationTimestampMs:d("MAWTimeUtils").toTimestamp(c.inviteExpireTs),inviterId:f,threadKey:e}),d("MAWUpdateLSThreadCapabilities").setGroupInviteTxn(a,e,f)]).then(function(){})})}g.call=a}),98);
__d("MAWBridgeInitOfflineQueueSyncCompleteHandler",["MessengerLogHistory","Promise"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=d("MessengerLogHistory").getInstance("maw_setup");a.debug("Init Offline Queue Sync Complete");return b("Promise").resolve()}g.call=a}),98);
__d("MAWBridgeInitOfflineQueueSyncProgressHandler",["Promise"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("Promise").resolve()}f.call=a}),66);
__d("MAWBridgeInitOfflineQueueSyncStartHandler",["MessengerLogHistory","Promise"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){a=d("MessengerLogHistory").getInstance("maw_setup");a.debug("Init Offline Queue Sync Start");return b("Promise").resolve()}g.call=a}),98);
__d("MAWBridgeInitOfflineQueueSyncUIReadyHandler",["MessengerLogHistory","Promise"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=d("MessengerLogHistory").getInstance("maw_setup");a.debug("Init Offline Queue Sync UI Read");return b("Promise").resolve()}g.call=a}),98);
__d("MAWBridgeInitSyncCompleteHandler",["MAWTTRC","MessengerLogHistory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("MessengerLogHistory").getInstance("maw_setup");a.debug("Init Sync Complete");d("MAWTTRC").markEvent("init_sync_received")});return h.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeMediaExpiredHandler",["MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeMediaExpiredHandler.bs",function(a,c){return a.table("attachments")["delete"]({hd:c,tl:{hd:b.msgId,tl:{hd:String(b.mediaId),tl:0}}})})}g.call=a}),98);
__d("WADualSendMsgUtils",["WAJids","WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Could not interpret as GroupJid"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to interpret jid "," as user or group jid"]);i=function(){return a};return a}var j="shadow_";f="GdstV8zG0ZhZP6Al1PJ8hLfMf6GfKMizuMtDtS0W2vtCPUeyGrCglOm9mFHOvMn7";function k(a){return a!=null&&a.startsWith(j)}function l(a){a=a.split("_")[1];a=a.split("@msgr")[0];return d("WAJids").toMsgrUserJid(a)}function m(a){a=a.split("_")[1];a=a.split("@g.us")[0];return d("WAJids").toGroupJid(a)}function a(a){var b=k(a),c=d("WAJids").interpretAsUserJid(a),e=d("WAJids").interpretAsGroupJid(a);if(b&&c!=null)return l(c);else if(b&&e!=null)return m(e);else{d("WALogger").LOG(i(),a);return a}}function b(a){return a.hasChild("test")}function c(a){return j+a}function e(a){if(k(a.chat)&&a.type==="group"){var b=d("WAJids").interpretAsGroupJid(a.chat);if(b==null){d("WALogger").ERROR(h());return a}a.chat=m(b);a.groupJid=m(b)}return a}g.DUAL_SEND_PREFIX=j;g.SHADOW_GROUP_NAME_POST_FIX=f;g.isDualSendJid=k;g.removeDualSendPrefixForUser=l;g.removeDualSendPrefixForGroup=m;g.removeDualSendPrefix=a;g.parseMessageForDualSend=b;g.prependDualSendPrefix=c;g.removeDualSendPrefixForFromJidChat=e}),98);
__d("MAWBridgeMsgUpdatedHandler",["I64","LSIntEnum","MAWAckLevel","MAWAdminMsgCTA","MAWMiActOnMiThreadReadyForChatId","MAWMsgReplySnippet","MAWUpdateMsg","MWChatInteraction.bs","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){a=d("MWChatInteraction.bs").get(d("MWChatInteraction.bs").s2sKey(a));if(a!=null){b=d("MAWAckLevel").levelToMessagingSendStatusV2(b.ack);d("I64").equal(b,d("LSIntEnum").ofNumber(2))?d("MWChatInteraction.bs").addMarkerPoint(a,"received_successful_server_ack"):d("I64").equal(b,d("LSIntEnum").ofNumber(4))&&d("MWChatInteraction.bs").addMarkerPoint(a,"received_failure_server_ack")}}function a(a,c,e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(c,e.chatId,"MAWBridgeMsgUpdatedHandler",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c){var f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("messages")).getKeyRange(c).filter(function(a){return a.messageId===e.msgId})));if(f==null)return;var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("attachments")).getKeyRange(c,e.msgId)));g=[f.offlineThreadingId,g==null?void 0:g.offlineAttachmentId];g.forEach(function(a){a!=null&&h(a,e)});g=(yield d("MAWAdminMsgCTA").getAdminMsgCtaStep(b,c,e));c=(yield d("MAWMsgReplySnippet").getReplySnippet(a,b,e,c));return d("MAWUpdateMsg").call(a,b,e,f,g,c)});return function(a,b){return c.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeMsgsLoadedHandler",["I64","LSClearMessagePlaceholderRange","LSFactory","LSInsertNewMessageRange","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeMsgsLoadedHandler",function(a,e){return c("LSClearMessagePlaceholderRange")(e,"",d("MAWTimeUtils").MAX_TIMESTAMP_MS,c("LSFactory")(a)).then(function(){var f,g,h,i,j,k,l,m;f=((f=b.rangeExtensionType)==null?void 0:f.minMsgTs)!=null?d("I64").of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=((g=b.rangeExtensionType)==null?void 0:g.maxMsgTs)!=null?d("I64").of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;h=(h=(h=b.rangeExtensionType)==null?void 0:h.minMsgId)!=null?h:"";i=(i=(i=b.rangeExtensionType)==null?void 0:i.maxMsgId)!=null?i:"";j=((j=b.rangeExtensionType)==null?void 0:j.rangeKind)==="extensionBefore"?f:d("MAWTimeUtils").MIN_TIMESTAMP_MS;k=((k=b.rangeExtensionType)==null?void 0:k.rangeKind)==="extensionAfter"?g:d("MAWTimeUtils").MAX_TIMESTAMP_MS;l=(l=(l=b.rangeExtensionType)==null?void 0:l.hasMoreBefore)!=null?l:!1;m=(m=(m=b.rangeExtensionType)==null?void 0:m.hasMoreAfter)!=null?m:!1;return c("LSInsertNewMessageRange")(e,f,g,h,i,j,k,l,m,void 0,c("LSFactory")(a))})})}g.call=a}),98);
__d("MAWEphemeralMessageExpirationStorage",["LSDatabaseSingleton","MAWBridgeDeleteMessagesHandler","asyncToGeneratorRuntime","clearTimeout","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(a,c,e){c.forEach(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=b.ts,e=b.chatId,f=b.msgId;f={msgId:f,threadId:e,ts:c};e=b.chatId;c=[f];b={messages:c,threadId:e};yield d("MAWBridgeDeleteMessagesHandler").call(a,b)});return function(a){return c.apply(this,arguments)}}());return h["delete"](e)}function j(a,d,e){return c("setTimeout")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=(yield c("LSDatabaseSingleton"));c("promiseDone")(e.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield i(b,a,d)});return function(a){return c.apply(this,arguments)}}(),"readwrite"))}),e)}function a(a,b,d,e){a=h.get(d);b=a==null?[b]:(c("clearTimeout")(a.timeoutId),a.msgs.map(function(a){return a.msgId}).indexOf(b.msgId)===-1?(a.msgs.push(b),void 0):void 0,a.msgs);a=j(b,d,e);h.set(d,{expirationTs:d,msgs:b,timeoutId:a})}function e(a){var b=a.msgId;a=h.get(a.countdownTs);if(a==null)return;b=a.msgs.map(function(a){return a.msgId}).indexOf(b);if(b>-1){a.msgs.splice(b,1);return}}g.setMessageForExpiration=a;g.clearMessageFromExpiration=e}),98);
__d("MAWBridgeMsgsStartCountdownHandler",["I64","MAWEphemeralMessageExpirationStorage","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return c.msgs.reduce(function(c,e){return c.then(function(){d("MAWEphemeralMessageExpirationStorage").setMessageForExpiration(a,e,e.countdownTs,e.millisecondsUntilCountdownTs);d("I64").of_int32(e.millisecondsUntilCountdownTs);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.chatId,"MAWBridgeMsgsStartCountdownHandler",function(a,c){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("messages")).getKeyRange(c,d("MAWTimeUtils").toTimestamp(e.ts),e.msgId)).then(function(c){if(c==null)return b("Promise").resolve();c=babelHelpers["extends"]({},c,{ephemeralExpirationTs:d("I64").of_float(e.countdownTs)});return a.table("messages").put(c)})})})},b("Promise").resolve())}g.call=a}),98);
__d("MAWBridgeNewMediaHandler",["I64","MAWMedia","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,e,f,g){return{attachmentFbid:e,attachmentIndex:(e=a==null?void 0:a.attachmentIndex)!=null?e:d("I64").zero,attachmentType:(e=a==null?void 0:a.attachmentType)!=null?e:d("MAWMedia").mediaTypeToMessageAttachmentType(b.mediaType,b.ephemeralMediaViewMode),authorityLevel:(e=a==null?void 0:a.authorityLevel)!=null?e:d("I64").zero,ephemeralMediaState:b.ephemeralMediaState!=null?d("I64").of_int32(b.ephemeralMediaState):a==null?void 0:a.ephemeralMediaState,ephemeralMediaViewMode:b.ephemeralMediaViewMode!=null?d("I64").of_int32(b.ephemeralMediaViewMode):a==null?void 0:a.ephemeralMediaViewMode,filename:(e=(e=b.filenames!=null?b.filenames[c]:null)!=null?e:b.defaultFilename)!=null?e:a==null?void 0:a.filename,filesize:b.filesize==null?a==null?void 0:a.filesize:d("I64").of_int32(b.filesize),hasMedia:b.hasMedia,hasXma:!1,isSharable:!1,messageId:c,offlineAttachmentId:f,playableDurationMs:b.duration==null?a==null?void 0:a.playableDurationMs:d("I64").of_int32(b.duration),previewHeight:b.previewHeight==null?a==null?void 0:a.previewHeight:d("I64").of_int32(b.previewHeight),previewHeightLarge:b.previewHeightLarge==null?a==null?void 0:a.previewHeightLarge:d("I64").of_int32(b.previewHeightLarge),previewWidth:b.previewWidth==null?a==null?void 0:a.previewWidth:d("I64").of_int32(b.previewWidth),previewWidthLarge:b.previewWidthLarge==null?a==null?void 0:a.previewWidthLarge:d("I64").of_int32(b.previewWidthLarge),threadKey:g,timestampMs:d("I64").of_int32(b.ts)}}function i(a,c){var e=c.mediaId,f=c.msgIds,g=c.offlineAttachmentId,i=c.threadId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,i,"MAWBridgeNewMediaHandler",function(a,i){var j,k=e.toString(),l=(j=g)!=null?j:k;return b("Promise").all(f.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=a.table("attachments"),f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e).getKeyRange(i,b)));b=h(f,c,b,k,l,i);return f!=null?e.put(babelHelpers["extends"]({},f,b)):e.add(b)});return function(a){return e.apply(this,arguments)}}())).then(function(){})})}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield i(a,b)});return j.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeNewMediaRangeHandler",["I64","LSFactory","LSIntEnum","LSThreadMediaGalleryGroup","LSUpsertAttachmentRange","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeNewMediaRangeHandler",function(a,e){var f=d("I64").of_int32(b.minMsgRowId),g=b.hasMoreBefore;return c("LSUpsertAttachmentRange")(e,d("LSIntEnum").ofNumber(c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS),f,g,c("LSFactory")(a))})}function a(a,b){return h(a,b).then(function(){})}g.call=a}),98);
__d("MAWBridgeNewMsgHandler",["I64","LSAuthorityLevel","LSIntEnum","LSMessageUnsendabilityStatus","LSQuickReplyType","MAWAckLevel","MAWAdminMsgCTA","MAWBridgeBuildMsg","MAWBridgeMsg","MAWMiActOnMiThreadReadyForChatId","MAWMsg","MAWMsgReply","MAWMsgReplySnippet","MAWMsgReplyStatus","MAWTimeUtils","MAWUpdateMsg","Promise","QPLUserFlow","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,d,e,f){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){var i;i=d("MAWTimeUtils").toTimestamp(f.type_===d("MAWMsg").unsent?(i=f.originalTs)!=null?i:f.ts:f.ts);a=(yield d("MAWBridgeBuildMsg").buildMessage(a,b,f,i));return b.table("messages").add(babelHelpers["extends"]({},a,{adminMsgCtaId:g==null?void 0:g.ctaId,adminMsgCtaTitle:g==null?void 0:g.title,adminMsgCtaType:g==null?void 0:g.ctaType,authorityLevel:d("LSIntEnum").ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),cannotUnsendReason:f.type_===d("MAWMsg").unsent||!f.isAuthorMe?d("LSIntEnum").ofNumber(c("LSMessageUnsendabilityStatus").DENY_FOR_NON_SENDER):void 0,displayedContentTypes:d("MAWMsg").getDisplayedContentTypes(f.type_,f.isForwarded,f.isExpiredXmaMsg),ephemeralDurationInSec:d("MAWBridgeBuildMsg").getEphemeralDurationInSec(f),ephemeralExpirationTs:void 0,forwardScore:void 0,hasQuickReplies:!1,hotEmojiSize:d("MAWBridgeMsg").getSpecialTextSize(f),isAdminMessage:f.isAdminMessage,isCollapsed:!1,isForwarded:void 0,isUnsent:f.type_===d("MAWMsg").unsent,localDataId:void 0,messageId:f.msgId,msUntilExpirationTs:void 0,offlineThreadingId:f.externalId!=null?f.externalId:f.msgId,primarySortKey:d("I64").of_float(f.sortOrderMs),quickReplyType:d("LSIntEnum").ofNumber(c("LSQuickReplyType").NONE),replyAttachmentExtra:void 0,replyAttachmentId:d("MAWMsgReply").getReplyAttachmentId(f),replyAttachmentType:d("MAWMsgReply").getReplyAttachmentType(f),replyCtaId:void 0,replyCtaTitle:void 0,replyMediaExpirationTimestampMs:d("MAWMsgReply").getReplyMediaExpirationTimestampMs(f),replyMediaPreviewHeight:d("MAWMsgReply").getReplyMediaHeight(f),replyMediaPreviewWidth:d("MAWMsgReply").getReplyMediaWidth(f),replyMediaUrl:void 0,replyMediaUrlFallback:void 0,replyMediaUrlMimeType:d("MAWMsgReply").getReplyMediaMimeType(f),replySnippet:h,replySourceId:d("MAWMsgReply").getReplySourceId(f),replySourceTimestampMs:d("MAWMsgReply").getReplySourceTimestampMs(f),replySourceType:d("MAWMsgReply").getReplySourceType(f),replySourceTypeV2:d("MAWMsgReply").getReplySourceTypeV2(f),replyStatus:d("MAWMsgReplyStatus").getLSReplyMessageStatus(f),replyToUserId:d("MAWMsgReply").getReplyUserId(f),replyType:void 0,secondarySortKey:void 0,senderId:d("I64").of_string(f.sender),sendStatus:d("MAWAckLevel").levelToMessagingSendStatus(f.ack),sendStatusV2:d("MAWAckLevel").levelToMessagingSendStatusV2(f.ack),stickerId:void 0,subscriptErrorMessage:void 0,takedownState:void 0,textHasLinks:!1,threadKey:e,timestampMs:i,unsentTimestampMs:d("MAWTimeUtils").toTimestamp(f.ts),viewedPluginContext:void 0,viewedPluginKey:void 0,viewFlags:d("LSIntEnum").ofNumber(0)}))});return i.apply(this,arguments)}function j(a,e,f){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,f.chatId,"BridgeNewMsgHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var g=(yield d("MAWAdminMsgCTA").getAdminMsgCtaStep(b,e,f)),i=(yield d("MAWMsgReplySnippet").getReplySnippet(a,b,f,e)),j=f.offlineMsg;if(j==null)return h(a,b,e,f,g,i).then(function(){f.qplEvent!=null&&f.instanceKey!=null&&c("QPLUserFlow").endSuccess(f.qplEvent,{instanceKey:f.instanceKey})});j=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("messages")).getKeyRange(e,d("I64").of_float(j.ts),j.msgId)));j==null?e=h(a,b,e,f,g,i):e=d("MAWUpdateMsg").call(a,b,f,j,g,i);return e.then(function(){f.qplEvent!=null&&f.instanceKey!=null&&c("QPLUserFlow").endSuccess(f.qplEvent,{instanceKey:f.instanceKey})})});return function(a,b){return e.apply(this,arguments)}}())}function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){yield b("Promise").all(d.filter(function(a){return!a.isDualSend}).map(function(b){return j(a,c,b)}))});return k.apply(this,arguments)}g.call=j;g.bulkCall=a}),98);
__d("MAWThreadDefaults",["fbt","I64","LSBitOffset","LSIntEnum","MAWGating","gkx","qex"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){if(d("MAWGating").isRepliesEnabled())return d("LSBitOffset").set(d("LSIntEnum").ofNumber(42),a);else return a}function b(a){if(c("gkx")("7045"))return d("LSBitOffset").set(d("LSIntEnum").ofNumber(4),a);else return a}function e(a){return c("qex")._("227")?d("LSBitOffset").set(d("LSIntEnum").ofNumber(7),a):a}function f(a){return c("qex")._("229")?d("LSBitOffset").set(d("LSIntEnum").ofNumber(6),a):a}function i(a){return c("qex")._("231")?d("LSBitOffset").set(d("LSIntEnum").ofNumber(9),a):a}var j=d("LSBitOffset").set(d("LSIntEnum").ofNumber(25),d("LSBitOffset").set(d("LSIntEnum").ofNumber(24),d("LSBitOffset").set(d("LSIntEnum").ofNumber(18),d("LSBitOffset").set(d("LSIntEnum").ofNumber(56),d("LSBitOffset").set(d("LSIntEnum").ofNumber(17),d("LSBitOffset").set(d("LSIntEnum").ofNumber(14),d("LSBitOffset").set(d("LSIntEnum").ofNumber(23),d("LSBitOffset").empty))))))),k=a(b(e(f(i(d("LSBitOffset").set(d("LSIntEnum").ofNumber(10),d("LSBitOffset").set(d("LSIntEnum").ofNumber(19),d("LSBitOffset").set(d("LSIntEnum").ofNumber(35),d("LSBitOffset").set(d("LSIntEnum").ofNumber(43),j))))))))),l=d("LSBitOffset").set(d("LSIntEnum").ofNumber(17),d("LSBitOffset").set(d("LSIntEnum").ofNumber(60),d("LSBitOffset").set(d("LSIntEnum").ofNumber(16),d("LSBitOffset").set(d("LSIntEnum").ofNumber(26),d("LSBitOffset").set(d("LSIntEnum").ofNumber(28),d("LSBitOffset").clear(d("LSIntEnum").ofNumber(27),k))))));function m(a){return d("I64").sub(a,d("I64").of_string("64"))}var n=d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(103),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(85),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(109),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(74),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(65),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(64),d("I64").of_string("64")),d("LSBitOffset").empty))))));h=h._("__JHASH__9ZFn8zMzjpf__JHASH__").toString();g.setReplyCapability=a;g.setGifCapability=b;g.setHotlikeCustomizationCapability=e;g.setThemeCustomizationCapability=f;g.setNicknameCapability=i;g.defaultOptimisticThreadCapabilities=j;g.defaultThreadCapabilities=k;g.defaultGroupThreadCapabilities=l;g.makeOffset=m;g.defaultThreadCapabilities_2=n;g.nullstateDescriptionText1=h;g.defaultThreadCapabilities_3=d("LSBitOffset").empty}),98);
__d("MAWBridgeOccamadilloVerifyThreadExistsHandler",["FBLogger","I64","LSAuthorityLevel","LSCoreClientFolderType","LSCreateE2EEMetadataThread","LSCreateOfflineThreadingID","LSFactory","LSIntEnum","LSThreadBitOffset","MAWFolderUtils","MAWJidUtils","MAWMiActGetThreadLifecycleState","MAWMiActOnActThreadReadyQueue","MAWMiActOnMiThreadReadyQueue","MAWMiActThreadLifecycleState","MAWThreadDefaults","MAWTimeUtils","Promise","WALoggerDeferred","WATimeUtils","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 3. Thread loading is fully complete for threadKey: ",", JID: ",", and state: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 2. Handle new authoritative thread for threadKey: ",", JID: ",", and state: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 1. Let MI server know about WA thread for JID: "," and state: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 5. Authoritative thread not found for chatId: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Thread is missing in Occamadillo verify thread exists"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Creating e2ee metadata optimistic thread.\n  threadKey: ","\n  bumpTimestampMs: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Detected 0 for last activity timestamp from MI for thread: ",", using local state timestamp: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] no folder type was supplied to Occamadillo verify thread exists handler"]);o=function(){return a};return a}function p(a){return d("I64").of_string(d("MAWJidUtils").threadIdForChatJid(a))}function q(a){a=d("MAWFolderUtils").systemFolderToLSCoreClientFolder(a);a==null&&(c("promiseDone")(d("WALoggerDeferred").ERROR(o())),a=d("I64").of_int32(c("LSCoreClientFolderType").INBOX));return a}function r(a,e){return e==null?c("LSCreateOfflineThreadingID")(d("I64").of_float(Date.now()),a).then(function(a){return a[0]}):b("Promise").resolve(d("I64").of_string(e))}function s(a){a=d("MAWTimeUtils").millisTimeToTimestamp(a);return d("I64").equal(a,d("I64").of_int32(0))?d("MAWTimeUtils").millisTimeToTimestamp(d("WATimeUtils").millisTime()):a}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(e.isDualSend)return b("Promise").resolve();var f=c("LSFactory")(a),g=s(e.lastActivityTs),h=(yield r(f,e.clientThreadKey)),i=d("I64").of_int32(e.chatId),j=q(e.folder),k=p(e.jid);e=e.isGroup?d("LSIntEnum").ofNumber(16):d("LSIntEnum").ofNumber(15);yield a.table("mi_act_mapping_table").put({clientThreadPk:i,jid:k,serverThreadKey:h});c("promiseDone")(d("WALoggerDeferred").LOG(m(),d("I64").to_string(h),d("I64").to_string(g)));return c("LSCreateE2EEMetadataThread")(k,h,e,j,g,f)});return u.apply(this,arguments)}function v(a,b,e){a=a;d("I64").equal(a,d("I64").of_int32(0))&&(c("promiseDone")(d("WALoggerDeferred").WARN(n(),d("I64").to_string(e),d("I64").to_string(b))),a=b);return a}function w(a,b){var c=[],e=d("LSIntEnum").ofNumber(105);a=d("LSThreadBitOffset").has(e,a);a&&c.push(e);return d("LSThreadBitOffset").set(c,b?d("MAWThreadDefaults").defaultGroupThreadCapabilities:d("MAWThreadDefaults").defaultThreadCapabilities,d("MAWThreadDefaults").defaultThreadCapabilities_2,d("MAWThreadDefaults").defaultThreadCapabilities_3)}function x(a,b,c){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield a.table("threads").get({hd:e,tl:0}));if(g==null){c("promiseDone")(d("WALoggerDeferred").ERROR(l()));return b("Promise").resolve()}var h=f.clientThreadKey!=null?d("I64").of_string(f.clientThreadKey):g.clientThreadKey,i=v(g.lastActivityTimestampMs,d("MAWTimeUtils").millisTimeToTimestamp(f.lastActivityTs),e),j=d("MAWTimeUtils").millisTimeToTimestamp(f.lastReadTs);f=w(g,f.isGroup);return a.table("threads").upsert({hd:e,tl:0},babelHelpers["extends"]({},g,{capabilities:f[0],capabilities2:f[1],capabilities3:f[2],clientThreadKey:h,lastActivityTimestampMs:i,lastReadWatermarkTimestampMs:j}))});return y.apply(this,arguments)}function z(a,b,c){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){yield a.table("mi_act_mapping_table").put({clientThreadPk:d("I64").of_int32(e.chatId),jid:p(e.jid),serverThreadKey:c}),yield b("Promise").all([x(a,c,e),B(a,c,e)])});return A.apply(this,arguments)}function B(a,b,c){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(c.clientThreadKey!=null){c=d("I64").of_string(c.clientThreadKey);d("I64").equal(b,c)||(yield a.table("threads")["delete"]({hd:c,tl:0}))}});return C.apply(this,arguments)}function D(a,b,c){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield a.table("threads").get({hd:e,tl:0}));g!=null&&d("I64").to_int32(g.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE&&(yield b("Promise").all([x(a,e,f),B(a,e,f)]));g==null&&c("promiseDone")(d("WALoggerDeferred").LOG(k(),f.chatId))});return E.apply(this,arguments)}function F(a,b){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=d("I64").of_string(d("MAWJidUtils").threadIdForChatJid(b.jid));e=(yield d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJid(a,e,"MAWBridgeOccamadilloVerifyThreadExistsHandler"));switch(e.type){case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY_BY_JID:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY_BY_CHAT_ID:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:c("promiseDone")(d("WALoggerDeferred").LOG(j(),b.jid,e.type));return t(a,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:var f=d("I64").to_string(e.serverThreadKey);c("promiseDone")(d("WALoggerDeferred").LOG(i(),f,b.jid,e.type));return z(a,e.serverThreadKey,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:f=d("I64").to_string(e.serverThreadKey);c("promiseDone")(d("WALoggerDeferred").LOG(h(),f,b.jid,e.type));return D(a,e.serverThreadKey,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occamadillo] Unimplemented VerifyThreadExists state: %s for JID: %s",e.type,b.jid);default:e.type;throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occamadillo] Unhandled VerifyThreadExists state: %s for JID: %s",e.type,b.jid)}});return G.apply(this,arguments)}function a(a,b){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield F(a,b);if(b.clientThreadKey!=null){var e=d("I64").of_string(b==null?void 0:b.clientThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.chatId,b.jid))}if(b.authoritativeThreadKey!=null){e=d("I64").of_string(b.authoritativeThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.chatId,b.jid))}e=(e=b.authoritativeThreadKey)!=null?e:b.clientThreadKey;if(e!=null)return d("MAWMiActOnMiThreadReadyQueue").processQueueOnMiThreadReady(a,d("I64").of_string(e),b.chatId,b.jid);return});return H.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeOneToOneMessageRequestLoadedHandler",["fbt","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWContactRelationshipType","MAWDbContact","MAWMessageRequestUtil.bs","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a,e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeOneToOneMessageRequestLoadedHandler",function(a,f){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(f)).then(function(c){if(c==null)return b("Promise").resolve([void 0,void 0,void 0,!1]);var f=d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("contacts")).getKeyRange(d("I64").of_string(e.fbid)));return b("Promise").all([b("Promise").resolve(c),f,b("Promise").resolve(e.relationship),b("Promise").resolve(d("LSMessagingThreadTypeUtil").isOneToOne(c.threadType))])}).then(function(e){var f=e[0];if(f==null)return b("Promise").resolve();var g=e[1];if(g==null)return b("Promise").resolve();var i=e[2];if(i==null)return b("Promise").resolve();if(!e[3])return b("Promise").resolve();e=d("I64").equal(g.authorityLevel,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))?d("MAWContactRelationshipType").getContactRelationshipType(g):i;if(f.folderName==="pending"||f.folderName==="other"||f.folderName==="spam"||f.folderName==="inbox"&&e===d("MAWDbContact").REVERSED_ONE_WAY_CONTACT&&!d("I64").equal(f.lastActivityTimestampMs,d("I64").zero)){g=d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil.bs").disabledThreadCapabilitiesForIncomingRequest,f.capabilities,f.capabilities2,f.capabilities3);i=f.folderName==="inbox"?h._("__JHASH__4F6x7gUU1-S__JHASH__").toString():void 0;e=[d("LSThreadBitOffset").set(d("MAWMessageRequestUtil.bs").enabledThreadCapabilitiesForIncomingRequest,g[0],g[1],g[2]),i]}else e=[[f.capabilities,f.capabilities2,f.capabilities3],void 0];g=e[0];i=babelHelpers["extends"]({},f,{additionalThreadContext:e[1],capabilities:g[0],capabilities2:g[1],capabilities3:g[2]});return a.table("threads").put(i).then(function(){})})})}g.call=a}),98);
__d("MAWBridgeParticipantRemovedHandler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeParticipantRemovedHandler",function(a,c){return a.table("participants")["delete"]({hd:c,tl:{hd:d("I64").of_string(b.userId),tl:0}})})}g.call=a}),98);
__d("MAWBridgeParticipantUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExists","MAWCurrentUser","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise","ReQLTable"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("MAWCurrentUser").getID(),j=d("I64").of_string(i);function a(a){return a.startsWith("shadow_")}function e(a,e){if(e.fbid.startsWith("shadow_"))return b("Promise").resolve();else return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeParticipantUpdatedHandler",function(a,f){var g=d("I64").of_string(e.fbid),k=d("MAWTimeUtils").toTimestamp(e.readWatermarkTs),l=d("MAWTimeUtils").toTimestamp(e.deliveredWatermarkTs),m=d("MAWTimeUtils").toTimestamp(e.lastReadActionTs),n=e.isSuperAdmin?h._("__JHASH__-gVxfbL98KU__JHASH__").toString():void 0,o={contents:!1},p={contents:!1};return d("ReQLTable").update(a.table("participants"),{hd:f,tl:{hd:g,tl:0}},function(a){if(a!=null){p.contents=!0;return{authorityLevel:a.authorityLevel,contactId:g,deliveredWatermarkTimestampMs:l,groupParticipantJoinState:e.isInvited?d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").INVITED):d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:a.isSuperAdmin,nickname:a.nickname,normalizedSearchTerms:a.normalizedSearchTerms,participantCapabilities:a.participantCapabilities,readActionTimestampMs:m,readWatermarkTimestampMs:k,subscribeSource:n,threadKey:f}}else{p.contents=!0;o.contents=!0;return{authorityLevel:d("I64").zero,contactId:g,deliveredWatermarkTimestampMs:l,groupParticipantJoinState:e.isInvited?d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").INVITED):d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:e.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:d("I64").zero,readWatermarkTimestampMs:k,subscribeSource:n,threadKey:f}}}).then(function(){if(p.contents)return d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,f).then(function(){var c=d("I64").equal(j,g),h=e.isAdmin;if(c)if(h)return d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,f);else return d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,f);else return b("Promise").resolve()});else return b("Promise").resolve()}).then(function(){if(o.contents)return c("LSVerifyContactRowExists")(g,d("LSIntEnum").ofNumber(c("LSContactIdType").FBID),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactType").USER),void 0,void 0,void 0,void 0,!1,!1,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),void 0,i===e.fbid,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").OPTIMISTIC),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactGender").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactViewerRelationship").UNKNOWN),void 0,c("LSFactory")(a));else return b("Promise").resolve()})})}g.currentUserId=i;g.currentUserIdAsInt64=j;g.checkIfDualSendUser=a;g.call=e}),98);
__d("MAWBridgeParticipantsUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExists","MAWCurrentUser","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise","ReQLTable"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("MAWCurrentUser").getID(),j=d("I64").of_string(i);function a(a){return a.startsWith("shadow_")}function e(a,e){e=e.participants.filter(function(a){return!a.fbid.startsWith("shadow_")});return b("Promise").all(e.map(function(e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeParticipantsUpdatedHandler",function(a,f){var g=d("I64").of_string(e.fbid),k=d("MAWTimeUtils").toTimestamp(e.readWatermarkTs),l=d("MAWTimeUtils").toTimestamp(e.deliveredWatermarkTs),m=d("MAWTimeUtils").toTimestamp(e.lastReadActionTs),n=e.isSuperAdmin?h._("__JHASH__-gVxfbL98KU__JHASH__").toString():void 0,o={contents:!1},p={contents:!1};return d("ReQLTable").update(a.table("participants"),{hd:f,tl:{hd:g,tl:0}},function(a){if(a!=null){p.contents=!0;return{authorityLevel:a.authorityLevel,contactId:g,deliveredWatermarkTimestampMs:d("I64").equal(l,d("I64").zero)?a.deliveredWatermarkTimestampMs:l,groupParticipantJoinState:e.isInvited?d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").INVITED):d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:a.isSuperAdmin,nickname:a.nickname,normalizedSearchTerms:a.normalizedSearchTerms,participantCapabilities:a.participantCapabilities,readActionTimestampMs:d("I64").equal(m,d("I64").zero)?a.readActionTimestampMs:m,readWatermarkTimestampMs:d("I64").equal(k,d("I64").zero)?a.readWatermarkTimestampMs:k,subscribeSource:n,threadKey:f}}else{p.contents=!0;o.contents=!0;return{authorityLevel:d("I64").zero,contactId:g,deliveredWatermarkTimestampMs:l,groupParticipantJoinState:e.isInvited?d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").INVITED):d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:e.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:d("I64").zero,readWatermarkTimestampMs:k,subscribeSource:n,threadKey:f}}}).then(function(){if(p.contents)return d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,f).then(function(){var b=d("I64").equal(j,g),c=e.isAdmin;if(b)if(c)return d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,f);else return d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,f);else return window.Promise.resolve()});else return b("Promise").resolve()}).then(function(){if(o.contents)return c("LSVerifyContactRowExists")(g,d("LSIntEnum").ofNumber(c("LSContactIdType").FBID),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactType").USER),void 0,void 0,void 0,void 0,!1,!1,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),void 0,i===e.fbid,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").OPTIMISTIC),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactGender").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactViewerRelationship").UNKNOWN),void 0,c("LSFactory")(a));else return b("Promise").resolve()})})})).then(function(){})}g.currentUserId=i;g.currentUserIdAsInt64=j;g.checkIfDualSendUser=a;g.call=e}),98);
__d("MAWBridgeRavenActionMsgForUIHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWMsg","MAWRavenUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeRavenActionMsgForUIHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){a=a.table("attachments");e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(e,c.ravenMsgId)));if(e==null)return b("Promise").resolve();if(e.ephemeralMediaState==null)return b("Promise").resolve();var f=d("I64").to_int32(e.ephemeralMediaState);if(e.ephemeralMediaViewMode==null)return b("Promise").resolve();var g=d("I64").to_int32(e.ephemeralMediaViewMode);f=d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(f);g=d("MAWMsg").MAWRavenMsgEphemeralType.cast(g);if(f==null||g==null)return b("Promise").resolve();f=d("MAWRavenUtils").getNextRavenMessageEphemeralState(f,g);if(f==null)return b("Promise").resolve();e.ephemeralMediaState;g=babelHelpers.objectWithoutPropertiesLoose(e,["ephemeralMediaState"]);e=babelHelpers["extends"]({ephemeralMediaState:d("I64").of_int32(f)},g);f={hd:g.threadKey,tl:{hd:g.messageId,tl:{hd:g.attachmentFbid,tl:0}}};return a.upsert(f,e)});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeReceivedChatStateHandler",["I64","MAWMiActOnMiThreadReadyForChatId","Promise","ServerTime","WAChatState"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeReceivedChatStateHandler",function(a,e){var f=d("I64").of_string(c.senderId),g=d("I64").of_float(3e3+d("ServerTime").getMillis());if(c.state===d("WAChatState").TYPING)return a.table("typing_indicator").upsert({hd:e,tl:{hd:f,tl:0}},{expirationTimestampMs:g,senderId:f,threadKey:e}).then(function(){});else if(c.state===d("WAChatState").IDLE)return a.table("typing_indicator")["delete"]({hd:e,tl:{hd:f,tl:0}}).then(function(){});else return b("Promise").resolve()})}g.call=a}),98);
__d("MAWBridgeReceivedReceiptHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeReceivedReceiptHandler",function(a,e){var f=d("I64").of_string(c.fbid),g=d("MAWTimeUtils").toTimestamp(c.lastReadWatermarkTs),h=d("MAWTimeUtils").toTimestamp(c.deliveredWatermarkTs),i=d("MAWTimeUtils").toTimestamp(c.lastReadActionTs);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("participants")).getKeyRange(e,f)).then(function(c){if(c!=null)return a.table("participants").put({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:d("I64").equal(h,d("I64").zero)?c.deliveredWatermarkTimestampMs:h,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:d("I64").equal(i,d("I64").zero)?c.readActionTimestampMs:i,readWatermarkTimestampMs:d("I64").equal(g,d("I64").zero)?c.readWatermarkTimestampMs:g,subscribeSource:c.subscribeSource,threadKey:c.threadKey,threadRoles:d("I64").zero});else return b("Promise").resolve()}).then(function(){})})}g.call=a}),98);
__d("MAWBridgeSyncContacts",["CurrentUser","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSVerifyContactRowExists","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h=c("CurrentUser").getID();function a(a,e){return e.reduce(function(b,e){var f=d("I64").of_string(e);return b.then(function(){return c("LSVerifyContactRowExists")(f,d("LSIntEnum").ofNumber(c("LSContactIdType").FBID),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactType").USER),void 0,void 0,void 0,void 0,!1,!1,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),void 0,h===e,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").OPTIMISTIC),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactGender").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactViewerRelationship").UNKNOWN),void 0,c("LSFactory")(a))}).then(function(){})},b("Promise").resolve())}g.currentUserFbid=h;g.call=a}),98);
__d("MAWBridgeBuildThreadSnippet",["MAWAdminMsg","MAWBridgeBuildMsgMentions","MAWDbChatId","MAWLocalizationType","MAWMiActOnMiThreadReadyForChatId","MAWVault","ReQL","asyncToGeneratorRuntime","first"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null?d("MAWVault").unvault(a):void 0}function i(a,b,c){if(a==null)return b;b=[].concat(b);switch(c){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:b[0]=a;break}return b}function a(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=e.snippetContactIDs,j=e.snippetMentionJIDs,l=e.snippetParams,m=e.snippetType,n=e.threadId;if(l==null||m==null||g==null)return f;e=(yield d("MAWBridgeBuildMsgMentions").buildThreadSnippetWithMentions(a,b,n,h(c("first")(l)),j,g,m,function(b){var c=b[0];b=b[1];c=d("MAWAdminMsg").buildLocalizedString(i(c,l,m),b,m);return k(a,n,c)}));f=e[0];b=e[1];return d("MAWAdminMsg").buildLocalizedString(i(f,l,m),b,m)});return j.apply(this,arguments)}function k(a,c,e){return a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,d("MAWDbChatId").unsafeCoerceToChatId(c),"MAWBridgeBuildThreadSnippet",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a.table("threads");b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b)));b&&(yield a.put(babelHelpers["extends"]({},b,{snippet:e})))});return function(b,c){return a.apply(this,arguments)}}())});return function(b){return a.apply(this,arguments)}}(),"readwrite")}g.buildBridgeThreadSnippet=a;g.mutateThreadSnippet=k}),98);
__d("MAWBridgeThreadBumpedHandler",["I64","MAWBridgeBuildThreadSnippet","MAWBumpThread","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","MWV2DualSendMessageContent.bs","ReQL","asyncToGeneratorRuntime","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e,f){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,f.threadId,"MAWBridgeThreadBumpedHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("threads")).getKeyRange(e)));if(g==null)return;g=(yield d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(a,b,f,g.snippet));if(d("MWV2DualSendMessageContent.bs").isDualSend(g))return;var h=f.snippetSenderContactId!=null?d("I64").of_string(f.snippetSenderContactId):void 0,i=c("getMAWLastMessageCtaType")(f);return d("MAWBumpThread").threadMutation(b,e,d("MAWTimeUtils").millisTimeToTimestamp(f.lastActivityTs),d("MAWTimeUtils").millisTimeToTimestamp(f.lastReadTs),g,h,i)});return function(a,b){return e.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeThreadBumpedServerHandler",["I64","LSBumpE2EEMetadataThread","LSFactory","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","WALoggerDeferred","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Bumping thread on server. threadKey: ",", bumpTimestampMs: ",", isLocalDeviceSend: ",""]);h=function(){return a};return a}function a(a,e){return e.isDualSend?b("Promise").resolve():d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeThreadBumpedServerHandle",function(a,b){var f=e.lastActivityTs;f=d("MAWTimeUtils").millisTimeToTimestamp(f);c("promiseDone")(d("WALoggerDeferred").LOG(h(),d("I64").to_string(b),d("I64").to_string(f),e.isCurrentDeviceSendingMsg));return c("LSBumpE2EEMetadataThread")(b,f,e.isCurrentDeviceSendingMsg,c("LSFactory")(a))})}g.call=a}),98);
__d("MAWBridgeThreadHiddenHandler",["LSFactory","LSIntEnum","LSOptimisticRemoveThread","LSThreadRemoveType","MAWDbChatId","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,d("MAWDbChatId").unsafeCoerceToChatId(b),"MAWBridgeThreadHiddenHandler",function(a,b){a=c("LSFactory")(a);return c("LSOptimisticRemoveThread")(b,d("LSIntEnum").ofNumber(c("LSThreadRemoveType").DELETE_THREAD),a)})}g.call=a}),98);
__d("MAWBridgeThreadTimestampsHandler",["CurrentUser","I64","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function h(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeThreadTimestampsHandler",function(a,e){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(e)).then(function(e){if(e==null)return b("Promise").resolve();e=babelHelpers["extends"]({},e,{lastReadWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs)});return a.table("threads").put(e)})})}function a(a,e){return h(a,e).then(function(){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeThreadTimestampsHandler",function(a,f){var g=d("I64").of_string(c("CurrentUser").getID());return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("participants")).getKeyRange(f,g)).then(function(c){if(c!=null)return a.table("participants").put({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:c.deliveredWatermarkTimestampMs,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(e.lastActivityTimestampMs),readWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(e.lastReadWatermarkTs),subscribeSource:c.subscribeSource,threadKey:c.threadKey});else return b("Promise").resolve()})})})}g.call=a}),98);
__d("MAWBridgeThreadUpdatedHandler",["I64","LSBitOffset","MAWBridgeBuildThreadSnippet","MAWBridgeUIEventDataValidation","MAWFolderUtils","MAWMiActOnMiThreadReadyForChatId","MWV2DualSendMessageContent.bs","ReQL","asyncToGeneratorRuntime","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return b!=null&&b==="viewer_not_subscribed"?d("LSBitOffset").clear(d("I64").sub(d("I64").of_int32(28),d("I64").of_string("64")),a):a}function i(a,b){var c=b.folder!=null?d("MAWFolderUtils").getMessagingFolderTag(b.folder):a.folderName;return(b=b.cannotReplyReason)!=null?b:c==="inbox"?void 0:a.cannotReplyReason}function a(a,e,f){var g=f.muteExpireTimeMs,j=f.snippetSenderContactId,k=f.threadId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,k,"MAWBridgeThreadUpdatedHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("threads")).getKeyRange(e)));if(e==null)return;var k=(yield d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(a,b,f,e.snippet)),l=i(e,f),m=c("getMAWLastMessageCtaType")(f);return b.table("threads").put(babelHelpers["extends"]({},e,{cannotReplyReason:l,capabilities2:h(e.capabilities2,l),folderName:e.folderName,lastMessageCtaType:m,muteExpireTimeMs:g==null?e.muteExpireTimeMs:d("I64").of_float(g),parentThreadKey:e.parentThreadKey,snippet:d("MWV2DualSendMessageContent.bs").isDualSend(k)?e.snippet:k,snippetSenderContactId:j==null?e.snippetSenderContactId:d("MAWBridgeUIEventDataValidation").stringToI64Opt(j)}))});return function(a,b){return e.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeThreadsLoadedHandler",["I64","MAWFolderUtils","MAWThreadId","MAWTimeUtils","Promise","ReQL.bs"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){var e=d("MAWFolderUtils").getClientSystemFolder(c.folderId);return d("ReQL.bs").first(d("ReQL.bs").getKeyRange(d("ReQL.bs").fromTableAscending(a.table("threads_ranges_v2__generated")),{hd:e,tl:0})).then(function(f){if(f!=null)return a.table("threads_ranges_v2__generated")["delete"]({hd:f.parentThreadKey,tl:{hd:f.minThreadKey,tl:{hd:f.minLastActivityTimestampMs,tl:0}}}).then(function(){return c.rangeKind==="threadRangeExtensionForLoadBefore"?d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.minThreadId).then(function(b){if(b!=null)return a.table("threads_ranges_v2__generated").put({hasMoreAfter:f.hasMoreAfter,hasMoreBefore:c.hasMore,isLoadingAfter:f.isLoadingAfter,isLoadingBefore:!1,maxLastActivityTimestampMs:f.maxLastActivityTimestampMs,maxThreadKey:f.maxThreadKey,minLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.minLastActivityTs),minThreadKey:b,parentThreadKey:f.parentThreadKey})}):a.table("threads_ranges_v2__generated").put({hasMoreAfter:f.hasMoreAfter,hasMoreBefore:f.hasMoreBefore,isLoadingAfter:f.isLoadingAfter,isLoadingBefore:!1,maxLastActivityTimestampMs:f.maxLastActivityTimestampMs,maxThreadKey:f.maxThreadKey,minLastActivityTimestampMs:f.minLastActivityTimestampMs,minThreadKey:f.minThreadKey,parentThreadKey:f.parentThreadKey})});switch(c.rangeKind){case"initialNoThread":return a.table("threads_ranges_v2__generated").put({hasMoreAfter:!1,hasMoreBefore:!1,isLoadingAfter:!1,isLoadingBefore:!1,maxLastActivityTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,maxThreadKey:d("I64").zero,minLastActivityTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,minThreadKey:d("I64").zero,parentThreadKey:e});case"initialThreadRange":return b("Promise").all([d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.minThreadId),d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.maxThreadId)]).then(function(b){var f=b[0];b=b[1];if(f!=null&&b!=null)return a.table("threads_ranges_v2__generated").add({hasMoreAfter:!1,hasMoreBefore:c.hasMore,isLoadingAfter:!1,isLoadingBefore:!1,maxLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.maxLastActivityTs),maxThreadKey:b,minLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.minLastActivityTs),minThreadKey:f,parentThreadKey:e})});case"threadRangeExtensionForLoadBefore":return b("Promise").resolve()}})}g.call=a}),98);
__d("MAWBridgeUIEventQueueQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(1056849266,"1765"),{annotations:{string_array:{events:b}},instanceKey:a})}function b(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056849266,"1765"),{instanceKey:a})}function d(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056849266,"1765"),"MAWBridgeUIEventHandlerFailure",{annotations:{string:{failedEventTag:b}},instanceKey:a})}g.start=a;g.endSuccess=b;g.endFailure=d}),98);
__d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler",["Promise"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("Promise").resolve()}f.call=a}),66);
__d("MAWBridgeUpdateE2EEMetadataParticipantsHandler",["LSFactory","LSUpdateE2EEMetadataParticipants","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeThreadsLoadedHandler",function(a,b){return c("LSUpdateE2EEMetadataParticipants")(b,c("LSFactory")(a))})}g.call=a}),98);
__d("MAWBridgeUpdateMinMessageHandler",["I64","MAWMiActOnMiThreadReadyForChatId","ReQL","ReQLTable","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=d("I64").of_float(b.minTimestampMs),f=b.minMessageId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeUpdateMinMessageHandler",function(a,g){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("messages_ranges_v2__generated")).getKeyRange(g)).then(function(h){if(h==null)return;var i=b.hasMoreBefore,j=i!=null?i:h.hasMoreBefore;return d("ReQLTable").update(a.table("messages_ranges_v2__generated"),{hd:g,tl:{hd:h.minTimestampMs,tl:{hd:h.minMessageId,tl:0}}},function(a){if(a!=null)return{hasMoreAfter:a.hasMoreAfter,hasMoreBefore:j,isLoadingAfter:a.isLoadingAfter,isLoadingBefore:a.isLoadingBefore,maxMessageId:a.maxMessageId,maxTimestampMs:a.maxTimestampMs,minMessageId:f,minTimestampMs:e,threadKey:a.threadKey};throw c("unrecoverableViolation")("Thread is missing in updating the min message in message range","messenger_e2ee_web")})})})}g.call=a}),98);
__d("MAWBridgeXMAShareExpiredHandler",["MAWMiActOnMiThreadReadyForChatId","Promise"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){var e=String(c.xmaId);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.chatId,"MAWBridgeXMAShareExpiredHandler",function(a,d){return a.table("attachments").get({hd:d,tl:{hd:c.msgId,tl:{hd:e,tl:0}}}).then(function(f){if(f==null)return b("Promise").resolve();f=[f.defaultCtaId,f.attachmentCta1Id,f.attachmentCta2Id,f.attachmentCta3Id].filter(Boolean);f=f.map(function(b){return a.table("attachment_ctas")["delete"]({hd:b,tl:0})});return b("Promise").all(f).then(function(){return a.table("attachments")["delete"]({hd:d,tl:{hd:c.msgId,tl:{hd:e,tl:0}}})})})})}g.call=a}),98);
__d("MAWBridgeXMAShareTombstonedHandler",["FBLogger","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e){var f=String(e.xmaId);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeXMAShareTombstonedHandler",function(a,g){return a.table("attachments").get({hd:g,tl:{hd:e.msgId,tl:{hd:f,tl:0}}}).then(function(h){if(h==null)return b("Promise").resolve();h=[h.defaultCtaId,h.attachmentCta1Id,h.attachmentCta2Id,h.attachmentCta3Id].filter(Boolean);h=h.map(function(b){return a.table("attachment_ctas")["delete"]({hd:b,tl:0})});return b("Promise").all(h).then(function(){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("attachments")).getKeyRange(g,e.msgId,f)).then(function(d){if(d!=null){d=babelHelpers["extends"]({},d,{attachmentCta1Id:void 0,attachmentCta2Id:void 0,attachmentCta3Id:void 0,cta1Title:void 0,cta1Type:void 0,cta2Title:void 0,cta2Type:void 0,cta3Title:void 0,cta3Type:void 0,defaultCtaId:void 0,defaultCtaTitle:void 0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,previewHeight:void 0,previewHeightLarge:void 0,previewWidth:void 0,previewWidthLarge:void 0,subtitleText:void 0,titleText:void 0});return a.table("attachments").put(d)}c("FBLogger")("messenger_e2ee_web").blameToPreviousFrame().mustfix("Trying to tombstone a secure xma attachment but no existing attachment");return b("Promise").resolve()})})})})}g.call=a}),98);
__d("MAWBridgeUIEventHandler",["FBLogger","JSResourceForInteraction","MAWAbPropsClient","MAWBridgeDeleteGroupInviteHandler","MAWBridgeDeleteMessageRangesV2Handler","MAWBridgeDeleteMessagesHandler","MAWBridgeDeleteReactionHandler","MAWBridgeDropAllSecureThreadsHandler","MAWBridgeGroupInfoUpdatedHandler","MAWBridgeGroupInviteLoadedHandler","MAWBridgeGroupInviteUpdateHandler","MAWBridgeInitOfflineQueueSyncCompleteHandler","MAWBridgeInitOfflineQueueSyncProgressHandler","MAWBridgeInitOfflineQueueSyncStartHandler","MAWBridgeInitOfflineQueueSyncUIReadyHandler","MAWBridgeInitSyncCompleteHandler","MAWBridgeMediaExpiredHandler","MAWBridgeMsgUpdatedHandler","MAWBridgeMsgsLoadedHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMediaRangeHandler","MAWBridgeNewMsgHandler","MAWBridgeNewXMAHandler","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantRemovedHandler","MAWBridgeParticipantUpdatedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeRavenActionMsgForUIHandler","MAWBridgeReactionUpsertHandler","MAWBridgeReceivedChatStateHandler","MAWBridgeReceivedReceiptHandler","MAWBridgeSyncContacts","MAWBridgeThreadBumpedHandler","MAWBridgeThreadBumpedServerHandler","MAWBridgeThreadHiddenHandler","MAWBridgeThreadTimestampsHandler","MAWBridgeThreadUpdatedHandler","MAWBridgeThreadsLoadedHandler","MAWBridgeUIEventQPLLogger","MAWBridgeUIEventQueueQPLLogger","MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler","MAWBridgeUpdateClientRestoreStatus","MAWBridgeUpdateE2EEMetadataParticipantsHandler","MAWBridgeUpdateMinMessageHandler","MAWBridgeXMAShareExpiredHandler","MAWBridgeXMAShareTombstonedHandler","MAWDualSendSimplePermissionsManager","MAWEphemeralMessageExpirationStorage","MAWGating","Promise","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe","gkx","promiseDone","recoverableViolation","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle UI Events: ",""]);h=function(){return a};return a}var i=c("requireDeferred")("MAWBridgeIssuePointQueryHandler").__setRef("MAWBridgeUIEventHandler"),j=c("requireDeferred")("MAWBridgeStartTraceHandler").__setRef("MAWBridgeUIEventHandler"),k=c("requireDeferred")("MAWBridgeStartTraceWithTraceIdHandler").__setRef("MAWBridgeUIEventHandler"),l=c("requireDeferred")("MAWBridgeTraceRecordCheckpointHandler").__setRef("MAWBridgeUIEventHandler"),m=c("requireDeferred")("MAWBridgeUpdateDyiStatus").__setRef("MAWBridgeUIEventHandler"),n=c("requireDeferred")("MAWBridgeUpdateTraceHandler").__setRef("MAWBridgeUIEventHandler"),o=c("requireDeferred")("MAWBridgeUploadMessageHandler").__setRef("MAWBridgeUIEventHandler"),p=c("requireDeferred")("MAWBridgeUploadThreadHandler").__setRef("MAWBridgeUIEventHandler"),q=c("gkx")("9017")===!0;function r(a,e,f){switch(f.tag){case"NewMsg":if(f.value.isDualSend)return b("Promise").resolve();else return d("MAWBridgeNewMsgHandler").call(a,e,f.value);case"MsgsStartCountdown":return d("MAWBridgeMsgsStartCountdownHandler").call(e,f.value);case"MsgClearCountdown":return b("Promise").resolve(d("MAWEphemeralMessageExpirationStorage").clearMessageFromExpiration(f.value));case"DropAllSecureThreads":return d("MAWBridgeDropAllSecureThreadsHandler").call(e);case"VerifyThreadExists":var g=f.value;return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(e,g);case"MsgUpdated":if(f.value.isDualSend)return b("Promise").resolve();else return d("MAWBridgeMsgUpdatedHandler").call(a,e,f.value);case"NewMedia":return d("MAWBridgeNewMediaHandler").call(e,f.value);case"NewMediaRange":return d("MAWBridgeNewMediaRangeHandler").call(e,f.value);case"MediaExpired":return d("MAWBridgeMediaExpiredHandler").call(e,f.value);case"XMAShareExpired":return d("MAWBridgeXMAShareExpiredHandler").call(e,f.value);case"NewXMA":return d("MAWBridgeNewXMAHandler").call(e,f.value);case"XMAShareTombstoned":return d("MAWBridgeXMAShareTombstonedHandler").call(e,f.value);case"ParticipantUpdated":return d("MAWBridgeParticipantUpdatedHandler").call(e,f.value);case"ParticipantRemoved":return d("MAWBridgeParticipantRemovedHandler").call(e,f.value);case"UpdateE2EEMetadataParticipants":return d("MAWBridgeUpdateE2EEMetadataParticipantsHandler").call(e,f.value);case"ReceivedReceipt":return d("MAWBridgeReceivedReceiptHandler").call(e,f.value);case"ThreadUpdated":return d("MAWBridgeThreadUpdatedHandler").call(a,e,f.value);case"GroupInfoUpdated":return d("MAWBridgeGroupInfoUpdatedHandler").call(e,f.value);case"ThreadBumped":return d("MAWBridgeThreadBumpedHandler").call(a,e,f.value);case"ThreadsLoaded":return d("MAWBridgeThreadsLoadedHandler").call(e,f.value);case"ThreadTimestampsUpdated":return d("MAWBridgeThreadTimestampsHandler").call(e,f.value);case"MsgsLoaded":return d("MAWBridgeMsgsLoadedHandler").call(e,f.value);case"InitSyncComplete":return d("MAWBridgeInitSyncCompleteHandler").call(e);case"StartTrace":return j.load().then(function(a){return a.call(e,f.value)});case"UpdateTrace":return n.load().then(function(a){return a.call(e,f.value)});case"ThreadHidden":return d("MAWBridgeThreadHiddenHandler").call(e,f.value);case"SyncContacts":return d("MAWBridgeSyncContacts").call(e,f.value);case"ReceivedChatState":return d("MAWBridgeReceivedChatStateHandler").call(e,f.value);case"ClockSkewUpdated":return b("Promise").resolve(d("WATimeUtils").setClockSkew(f.value));case"ABPropsUpdated":return b("Promise").resolve(d("MAWAbPropsClient").rewrite(f.value));case"UpsertReaction":return d("MAWBridgeReactionUpsertHandler").call(e,f.value);case"DeleteReaction":return d("MAWBridgeDeleteReactionHandler").call(e,f.value);case"UploadMessage":return o.load().then(function(a){return a.call(e,f.value)});case"UploadThread":return p.load().then(function(a){return a.call(e,f.value)});case"CallFinishAddDevice":return c("JSResourceForInteraction")("MAWBridgeCallFinishAddDeviceHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"UploadAttachment":return c("JSResourceForInteraction")("MAWBridgeUploadAttachmentHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"ResignAttachmentCDNUrl":return c("JSResourceForInteraction")("MAWBridgeResignAttachmentCDNUrlHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"DeleteMessages":return d("MAWBridgeDeleteMessagesHandler").call(e,f.value);case"RestoreMessageBatch":return c("JSResourceForInteraction")("MAWBridgeRestoreMessageBatchHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"OneToOneMessageRequestLoaded":return d("MAWBridgeOneToOneMessageRequestLoadedHandler").call(e,f.value);case"GroupInviteUpdate":return d("MAWBridgeGroupInviteUpdateHandler").call(e,f.value);case"InitOfflineQueueSyncStart":return d("MAWBridgeInitOfflineQueueSyncStartHandler").call(e,f.value);case"InitOfflineQueueSyncComplete":return d("MAWBridgeInitOfflineQueueSyncCompleteHandler").call(e);case"InitOfflineQueueSyncProgress":return d("MAWBridgeInitOfflineQueueSyncProgressHandler").call(e,f.value);case"InitOfflineQueueSyncUIReady":return d("MAWBridgeInitOfflineQueueSyncUIReadyHandler").call(e);case"UpdateDyiStatus":return m.load().then(function(a){return a.call(e,f.value)});case"DeleteGroupInvite":return d("MAWBridgeDeleteGroupInviteHandler").call(e,f.value);case"TraceRecordCheckpoint":return l.load().then(function(a){return a.call(e,f.value)});case"DeleteMessageRangesV2":return d("MAWBridgeDeleteMessageRangesV2Handler").call(e,f.value);case"UpdateMinMessage":return d("MAWBridgeUpdateMinMessageHandler").call(e,f.value);case"IssuePointQuery":return i.load().then(function(a){return a.call(e,f.value)});case"ThreadBumpedServer":return d("MAWBridgeThreadBumpedServerHandler").call(e,f.value);case"ParticipantsUpdated":return d("MAWBridgeParticipantsUpdatedHandler").call(e,f.value);case"StartTraceWithTraceId":return k.load().then(function(a){return a.call(e,f.value)});case"UpdateClientRestoreStatus":return d("MAWBridgeUpdateClientRestoreStatus").call(e,f.value);case"NewMsgs":return d("MAWBridgeNewMsgHandler").bulkCall(a,e,f.value.msgs);case"UnArchivedSelfDeviceChangeAlerts":return d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler").call(e,f.value);case"EphemeralSettingsUpdatedForUI":return c("JSResourceForInteraction")("MAWBridgeEphemeralSettingsUpdatedForUIHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"RavenActionUpdate":return d("MAWBridgeRavenActionMsgForUIHandler").call(e,f.value);case"GroupInviteLoaded":return d("MAWBridgeGroupInviteLoadedHandler").call(e,f.value);default:return b("Promise").resolve()}}function a(a,b){if(q)return;var e=d("MAWGating").isArmadillo(),f=d("MAWDualSendSimplePermissionsManager").isDualSendUser();if(!e&&!f){c("recoverableViolation")("User is neither part of armadillo QE and dual send QE but somehow loaded this handler","messenger_web_product");return}e={};e=b.reduce(function(a,b){a[b.tag]=((b=a[b.tag])!=null?b:0)+1;return a},e);d("WATagsLogger").TAGS(["MAWBridgeUIEvent"]).LOG(h(),e);c("promiseDone")(s(a,b))}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=(yield a);a=d("MAWBridgeUIEventQPLLogger").getInstanceKey();var g=e.map(function(a){return a.tag}),h="";d("MAWBridgeUIEventQueueQPLLogger").start(a,g);var i=(yield f.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){for(var b=0;b<e.length;b++){var g=e[b],i=d("MAWBridgeUIEventQPLLogger").getInstanceKey();d("MAWBridgeUIEventQPLLogger").start(i,g,{suppress:q});try{yield r(f,a,g),d("MAWBridgeUIEventQPLLogger").endSuccess(i)}catch(a){var j=c("getErrorSafe")(a);h=g.tag;d("MAWBridgeUIEventQPLLogger").endFailure(i,g.tag);c("FBLogger")("messenger_e2ee_web").catching(j).mustfix("[MAWBridgeUIEventHandler] Failed to handle UI event: %s",g.tag);return!1}}return!0});return function(b){return a.apply(this,arguments)}}(),"readwrite"));!i?(d("MAWBridgeUIEventQueueQPLLogger").endFailure(a,h),c("FBLogger")("messenger_e2ee_web").mustfix("MAWBridgeUIEventHandler] Did not commit UI events to DB: %s",g.toString())):d("MAWBridgeUIEventQueueQPLLogger").endSuccess(a)});return t.apply(this,arguments)}g.handleEvents=a}),98);
__d("MAWBridgeDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MAWBridge").__setRef("MAWBridgeDeferred");function a(){return h.load().then(function(a){a=a.getBridge;return a()})}g["default"]=a}),98);
__d("MAWOccamadilloOnMutexChange",["I64","LSDefaultSyncGroups","LSIntEnum","LSSyncGroupsUtils","MAWGating","Promise","WALogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Resetting sync cursor and network request"]);h=function(){return a};return a}function i(a){var c=d("LSDefaultSyncGroups").e2eeMetadataSyncGroup;if(!d("MAWGating").isOccamadilloResumeSyncEnabled()&&c!=null)return a.table("sync_groups").put(babelHelpers["extends"]({},d("LSSyncGroupsUtils").defaultSyncGroup,{groupId:d("LSIntEnum").ofNumber(c.groupId)}));else return b("Promise").resolve()}function j(a){if(!d("MAWGating").isOccamadilloResumeSyncEnabled())return a.table("network_requests").put({epochId:void 0,failureCount:d("I64").zero,lastDelayedRequestTimestampMs:void 0,lastSentTimestampMs:d("I64").zero,lastSyncRequestTimestampMs:d("I64").zero,networkTaskIdentifier:void 0,syncDatabaseId:d("LSIntEnum").ofNumber(95),taskQueueName:""});else return b("Promise").resolve()}function a(a){d("WALogger").LOG(h()),c("promiseDone")(a.runInTransaction(function(a){return b("Promise").all([i(a),j(a)])},"readwrite"))}g.onOccamadilloMutexChange=a}),98);
__d("MAWCommonBackendSetup",["MAWAppMutex","MAWEncyptionIndexedDbV2","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWVaultMaterialsStorage","MWSetupDBEncryption","Promise","asyncToGeneratorRuntime","cr:3484","gkx","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonBackendSetup");function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){e.start();e.logPoint("setup_armadillo_backend");h.onReadyImmediately(function(a){a=a.setupMainWaLogger;return a()});yield e.measurePerformance("detection_support",function(){var a=window.indexedDB!=null,c=d("MAWLocalStorage").isLocalStorageAvailable();if(!a)throw new(d("MAWInit").MAWInitError)("indexeddb_not_supported_by_browser");if(!c)throw new(d("MAWInit").MAWInitError)("localstorage_not_supported");return b("Promise").resolve()});var g=e.measurePerformance("setup_vault_materials",function(){return d("MAWVaultMaterialsStorage").setupVaultMaterials().then(function(a){c("gkx")("4463")||d("MAWVaultMaterialsStorage").listenToVaultMaterialsRequest();return a})}),i=(yield e.measurePerformance("acquire_mutex",function(){var a=d("MAWAppMutex").use().init(),e=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();if(e){c("promiseDone")(a);return b("Promise").resolve(!0)}return a})),j=(yield e.measurePerformance("ear_db_setup",function(){return e.measurePerformance("make_encryption_db",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MWSetupDBEncryption").init());d("MAWEncyptionIndexedDbV2").maybeSetEncryptionDbOnVersionChange(function(){d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)});return a}))}));if(!j.success)throw new(d("MAWInit").MAWInitError)("keychain_setup_failure").catching(j.error);b("cr:3484")!=null&&c("promiseDone")(b("cr:3484").setupArmadilloPushNotifications());if(!i)throw new(d("MAWInit").MAWInitError)("maw_appmutex_no_permission");var k=(yield g);yield e.measurePerformance("setup_worker",function(){return a(j.value,k,f)})});return i.apply(this,arguments)}g.setupArmadilloBackend=a}),98);
__d("MAWReinit",["ExecutionEnvironment","MAWEBSwitch","MAWGating","QPLUserFlow","UserTimingUtils","asyncToGeneratorRuntime","gkx","performanceNow","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(25310984,"169");function a(a){var e=a!=null?{instanceKey:a}:void 0,f=!1,g=!1;function i(){if(g)return;g=!0;c("QPLUserFlow").start(h,babelHelpers["extends"]({cancelOnUnload:!0,onFlowTimeout:function(){f=!0},timeoutInMs:c("ExecutionEnvironment").canUseDOM?6e4:0},e));n()}function j(a){if(!g||f)return;n();c("QPLUserFlow").addPoint(h,a,e)}function k(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(h,{bool:(d={},d[a]=b,d)})}function l(a){n(),f=!0,c("QPLUserFlow").addAnnotations(h,{string:{failReason:a}},e),c("QPLUserFlow").endFailure(h,"maw_init_fail",e),m=!1}var m=!1;function n(){if(m)return;m=!0;c("QPLUserFlow").addAnnotations(h,{bool:{armadillo_init_sync_api_improvements:c("gkx")("1115"),isEBEnabled:c("MAWEBSwitch").isEnabled(),isIndexedDbEarEnabled:!0,isTlcPublicUser:d("MAWGating").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}})}function o(a){n(),f=!0,c("QPLUserFlow").addAnnotations(h,{string:{cancelReason:a}},e),c("QPLUserFlow").endCancel(h,e),m=!1}function p(){n(),f=!0,c("QPLUserFlow").endSuccess(h,e),m=!1}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=c("performanceNow")(),f=a+"_start",g=a+"_end";j(f);f=(yield b());j(g);c("gkx")("8518")&&d("UserTimingUtils").measureModern(a,{end:c("performanceNow")(),start:e});return f});return r.apply(this,arguments)}return{addBoolAnnotation:k,cancel:o,endSuccess:p,fail:l,logPoint:j,measurePerformance:q,start:i}}g.getMAWReinit=a}),98);
__d("MAWReinitWorker",["MAWCommonBackendSetup","MAWOccamadilloOnMutexChange","MAWReinit","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.allTablesPersisted,e=a.db,f=a.dispatch,g=a.dispatchClearEphemeralSettings,h=a.environment,i=a.getOrSetupWorker,j=a.instanceKey,k=a.logout,l=a.reregisterDevice,m=a.setupBridge;a=d("MAWReinit").getMAWReinit(j);yield d("MAWCommonBackendSetup").setupArmadilloBackend(i,a,function(a){c("promiseDone")(m({dispatch:f,environment:h,logout:k,reregisterDevice:l,worker:a}).then(function(){b||d("MAWOccamadilloOnMutexChange").onOccamadilloMutexChange(e)}))});a.endSuccess();g()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("MessageSendsClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1271");b=d("FalcoLoggerInternal").create("message_sends_client",a);e=b;g["default"]=e}),98);
__d("MWLogSend.bs",["I64","MessageSendsClientFalcoEvent","ReQL.bs","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h,i,j,k,l,m,n,o,p,q,r){c("promiseDone")(d("ReQL.bs").toArray(d("ReQL.bs").filter(d("ReQL.bs").getKeyRange(d("ReQL.bs").fromTableAscending(a.table("participants")),{hd:b,tl:0}),function(a){return!d("I64").equal(a.contactId,h)})).then(function(a){var h=a.map(function(a){return d("I64").to_string(a.contactId)}),q=n!=null?n:d("I64").to_string(b),r=o!=null?d("I64").to_string(d("I64").of_float(o)):void 0;c("MessageSendsClientFalcoEvent").log(function(){return{additional_tags:p,backend:m,event_type:l,feature_tags:void 0,group_thread_subtype:void 0,igd_action:void 0,igd_target_type:void 0,igd_verb:void 0,initiating_app_id:void 0,is_reply:k,message_attachment_fbids:g.map(String),message_id:void 0,message_type:j,messaging_thread_fbid:q,messaging_thread_type:d("I64").to_int32(e),msg_ttl:r,nav_chain:void 0,nonce:void 0,offline_threading_id:f,recipient_fbids:h,send_attribution:d("I64").to_int32(i),send_attribution_raw:void 0,view_mode:void 0}})}))}g.log=a}),98);
__d("MAWCommonSetupBridge",["BrowserLockManager","CurrentUser","ErrorTransport","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWBridge","MAWChatJid","MAWCrossWorkerPortal","MAWCurrentUser","MAWDbMedia","MAWEBSwitch","MAWFrontendMediaUtils","MAWGating","MAWJobActionsV2","MAWLogMultipleTabs","MAWTTRCSafe","MAWThreadCutover.bs","MAWVault","MAWXMAUtils","MWLogSend.bs","ODS","Promise","QPLEvent","QPLUserFlow","URLMatcher","WACrossWorkerPortal","WADevToolMessageChannel","WADevToolsBridge","WADualSendMsgUtils","WAJids","cr:2036","err","gkx","justknobx","pageID","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonSetupBridge"),i=new Set([25312111,25311870]),j=new Map(),k=new Map(),l=new Map([[d("MAWDbMedia").MEDIA_TYPE.IMAGE,8],[d("MAWDbMedia").MEDIA_TYPE.VIDEO,10],[d("MAWDbMedia").MEDIA_TYPE.GIF,6],[d("MAWDbMedia").MEDIA_TYPE.STICKER,4],[d("MAWDbMedia").MEDIA_TYPE.PTT,11],[d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE,9]]),m=new Set([25312150,25313100,25304093,1056840931,25299294]);function n(a,b){return a+"_"+b}function o(a,b,c,d,e,f,g){if(a==="revokeMsg")return 26;if(e!=null)return e;if(c)return 3;if(d&&f===!1)return 13;if(g===!0)return 13;a=b!=null?l.get(b):null;return(e=a)!=null?e:0}function p(a,b,e){return c("LSDatabaseSingleton").then(function(f){return d("MAWThreadCutover.bs").isCutoverSecureThreadFromChatJid(f,a).then(function(a){c("QPLUserFlow").addAnnotations(b,{bool:{isCutover:a}},{instanceKey:e})})})}var q={fbErrorProxy:function(a){d("ErrorTransport").log(a)},log:function(a){var b=a.logLevel,c=a.logString,d=a.tags;switch(b){case"log":h.onReadyImmediately(function(a){a=a.info;return a(c,d)});return;case"warn":h.onReadyImmediately(function(a){a=a.warn;return a(c,d)});return;case"logRestricted":h.onReadyImmediately(function(a){a=a.logRestricted;return a(c,d)});return;case"debug":break;case"error":break;default:break}},logError:function(a){var b=a.entriesToReport,c=a.framesToPop,d=a.logString,e=a.message,f=a.stack,g=a.tags;h.onReadyImmediately(function(a){a=a.logError;return a(d,g,e,f,c,b)})},odsBumpEntityKey:function(a){var b=a.amount,e=a.entity;a=a.key;d("ODS").bumpEntityKey(3185,e,a+"."+(c("CurrentUser").getAppID()||"unknown"),b)},onJobFinished:function(a){a.type==="createGroup"&&a.originalArgs.key!=null&&d("MAWJobActionsV2").recentFinishedJobsCache.set(a.originalArgs.key,a.result);switch(a.type){case"sendMsg":case"sendMediaMsg":case"sendReactionMsg":case"sendXMAShareMsg":case"forwardMsg":var b=a.originalArgs.chatJid,e=a.type==="sendXMAShareMsg"?a.originalArgs.xmaMsgExternalId:a.originalArgs.externalId;j.set(n(b,e),babelHelpers["extends"]({},a.originalArgs,{type:"sendMsg"}));break;case"revokeMsgs":b=a.result;b.forEach(function(a){var b=a.deleting;a=a.original;j.set(n(b.chat,b.externalId),{chatJid:a.chat,externalId:a.externalId,type:"revokeMsg"})});break;case"sendAppData":e=a.originalArgs;var f=a.result;(b=e.args.contents.actions)==null?void 0:b.forEach(function(a){a=a.messageAction;if(a==null||a.type!=="delete_for_me"||f.type!=="not_sent")return;k.set(f.appDataExternalId,{chatJid:a.protocolMsgId.chat,externalId:a.protocolMsgId.externalId,type:"deleteMsgForMe"})});break}if(a.type==="sendWrittenMsg"){e=a.originalArgs.protocolMsgId;b=e.chat;e=e.externalId;b=n(b,e);var g=j.get(b);j["delete"](b);if(a.result.type==="success"&&g!=null){var h,i=g.type!=="revokeMsg"?e:g.externalId,l=g.args,m=g.chatJid;b=g.file;e=g.type;g=(l==null?void 0:l.reactToAuthor)!=null;var p=null;g&&(p=(l==null?void 0:l.reaction)!=null?20:27);g=(l==null?void 0:l.specialTextSize)!=null;b=b!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type).mediaType:null;var q=(l==null?void 0:l.xmaMessageType)!=null,r=(l==null?void 0:l.quote)!=null||d("MAWXMAUtils").isXMAStoryReply(l==null?void 0:l.xmaMessageType);h=c("URLMatcher").match(d("MAWVault").unvault((h=l==null?void 0:l.content)!=null?h:""));h=h!=null&&h.length>0;var s=o(e,b,g,q,p,r,h),t=d("WAJids").switchOnMsgrChatJidType(m,{group:function(){return d("LSIntEnum").ofNumber(16)},user:function(){return d("LSIntEnum").ofNumber(15)}});c("promiseDone")(c("LSDatabaseSingleton").then(function(a){var b=(l==null?void 0:l.source)?l.source:d("LSIntEnum").ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN);c("promiseDone")(d("MAWChatJid").toThreadKey(a,m).then(function(e){if(c("justknobx")._("154")&&d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("BrowserLockManager")!=null&&!d("MAWLogMultipleTabs").hasUniqueLock()))return;d("MWLogSend.bs").log(a,e,t,i,[],d("I64").of_string(d("MAWCurrentUser").getID()),b,s,r,1,1,d("I64").to_string(e),l==null?void 0:(e=l.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,d("WADualSendMsgUtils").isDualSendJid(m)?["dst:8"]:void 0,void 0)}))}))}}if(a.type==="sendWrittenAppData"){e=a.originalArgs.appDataExternalId;b=k.get(e);k["delete"](e);if(b!=null&&b.type==="deleteMsgForMe"&&a.result.type==="success"){var u=b.chatJid,v=b.externalId,w=d("WAJids").switchOnMsgrChatJidType(u,{group:function(){return d("LSIntEnum").ofNumber(16)},user:function(){return d("LSIntEnum").ofNumber(15)}});c("promiseDone")(c("LSDatabaseSingleton").then(function(a){c("promiseDone")(d("MAWChatJid").toThreadKey(a,u).then(function(b){d("MWLogSend.bs").log(a,b,w,v,[],d("I64").of_string(d("MAWCurrentUser").getID()),d("LSIntEnum").ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),25,!1,3,1,d("I64").to_string(b),void 0,d("WADualSendMsgUtils").isDualSendJid(u)?["dst:8"]:void 0,void 0)}))}))}}},qplEvent:function(a){var e=a.action,f=a.annotations,g=a.debugInfo,h=a.error,j=a.event,k=a.instanceKey,l=a.nonTrackableAnnotations,n=a.timestamp;if(!c("CurrentUser").isEmployee()&&i.has(d("QPLEvent").getMarkerId(j)))return;var o=k||0;k=l==null?void 0:(a=l.string)==null?void 0:a.jid;l=k!=null?d("WAJids").validateChatJid(k):void 0;a=m.has(d("QPLEvent").getMarkerId(j))&&l!=null?p(l,j,o):b("Promise").resolve();switch(e.type){case"start":c("QPLUserFlow").start(j,{annotations:babelHelpers["extends"]({},f||{},{bool:babelHelpers["extends"]({},(f==null?void 0:f.bool)||{},{handleDeviceNotificationInWa:c("gkx")("4464"),isBulkifyHIMEnabled:d("MAWGating").isBulkifyHIMEnabled(),isDev:0,isDeviceRegistrationDomainUniquenessEnabled:c("gkx")("7858"),isEBEnabled:c("MAWEBSwitch").isEnabled(),isGifSearchEnbled:c("gkx")("7045"),isICDCEnabled:c("gkx")("8973"),isM1M2OverrideUser:c("gkx")("3444"),isSpillOverCAUser:c("gkx")("5014"),isSpillOverVNUser:c("gkx")("5264"),isTlcPublicUser:d("MAWGating").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()})}),instanceKey:o,timestamp:n});break;case"success":c("QPLUserFlow").addAnnotations(j,{bool:{isRelaxedDurability:!0}},{instanceKey:o});a["finally"](function(){c("QPLUserFlow").endSuccess(j,{annotations:f,instanceKey:o,timestamp:n})});break;case"point":f&&c("QPLUserFlow").addAnnotations(j,f,{instanceKey:o});d("QPLEvent").getMarkerId(j)===1056839232?d("MAWTTRCSafe").markEvent(e.name,n):c("QPLUserFlow").addPoint(j,e.name,{instanceKey:o,timestamp:n});break;case"annotations":c("QPLUserFlow").addAnnotations(j,(k=f)!=null?k:{},{instanceKey:o});break;case"failure":c("QPLUserFlow").addAnnotations(j,{bool:{isRelaxedDurability:!0}},{instanceKey:o});a["finally"](function(){c("QPLUserFlow").endFailure(j,e.name,{annotations:f,instanceKey:o,timestamp:n})});break;case"error":c("QPLUserFlow").markError(j,e.name,{debugInfo:g,error:h,instanceKey:o});break;default:throw c("err")("Bridge sends unreachable qplEvent action type")}}},r=function(a,b){a.push(b);return a};a=function(a){var e=a.customizeEventHandlers;a=a.worker;var f=d("MAWBridge").getBridge();f.setHandlers("event",babelHelpers["extends"]({},q,e));e=d("MAWCrossWorkerPortal").getOrCreateCrossWorkerPortal(f,["backend"],r);e.setPort(a);if(c("gkx")("5147")){var g=d("WADevToolsBridge").getDevToolBridge();a=new MessageChannel();var h=d("WACrossWorkerPortal").attachPortal(g,["backend"],r,c("pageID")),i=d("WACrossWorkerPortal").attachPortal(g,["devtool"],r,c("pageID"));h.setPort(d("WADevToolMessageChannel").getMostRecentChannel().port1);i.setPort(a.port1);b("cr:2036")==null?void 0:b("cr:2036").connectAddonPort(a.port2);e.addListener(function(a,b){return g.fireAndForget("devtool","bridgeMessage",{direction:b==="outgoing"?"toWorker":"toMain",msg:a,ts:Date.now()},!0)})}return b("Promise").resolve(f)};g.commonBridgeEventHandlers=q;g.initBridge=a}),98);
__d("MAWSetupBridgeOfflineSnapshot",["InteractionTracingMetrics","MAWBridgeDeferred","MAWGating","MAWTTRC","MWChatInteraction.bs","WAOfflineUtils","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: "," / ",", messages: "," / ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Progress: "," / ",", messages: "," / ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",", messages: ",""]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["ServerRPC","Offline"]);function l(a){d("MAWTTRC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction.bs").get(d("MWChatInteraction.bs").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.downloaded,e=a.expected,f=a.priorityStatus,g=a.status;a=a.timestamp;var m=(yield c("MAWBridgeDeferred")());d("MAWGating").enableProtocolQueueChatProcessing()&&f===d("WAOfflineUtils").OfflineStatus.Complete&&(d("MAWTTRC").markEvent("worker_download_offline_queue_end",a),d("MAWTTRC").markEvent("main_download_offline_queue_end"));switch(g){case d("WAOfflineUtils").OfflineStatus.Initializing:k.LOG(j(),e.count,e.message);l(e.count);m==null?void 0:m.fireAndForget("event","uiUpdate",{events:[{tag:"InitOfflineQueueSyncStart",value:e.count}]});d("MAWTTRC").markEvent("worker_download_offline_queue_start",a);return d("MAWTTRC").markEvent("main_download_offline_queue_start");case d("WAOfflineUtils").OfflineStatus.Processing:k.LOG(i(),b.count,e.count,b.message,e.message);return m==null?void 0:m.fireAndForget("event","uiUpdate",{events:[{tag:"InitOfflineQueueSyncProgress",value:b.count}]});case d("WAOfflineUtils").OfflineStatus.Complete:k.LOG(h(),b.count,e.count,b.message,e.message);d("MAWTTRC").addIntAnnotation("offlineQueueDownloadedCount",b.count);m==null?void 0:m.fireAndForget("event","uiUpdate",{events:[{tag:"InitOfflineQueueSyncProgress",value:e.count}]});d("MAWTTRC").markEvent("worker_download_offline_queue_end",a);return d("MAWTTRC").markEvent("main_download_offline_queue_end");case d("WAOfflineUtils").OfflineStatus.Failed:return}});return function(b){return a.apply(this,arguments)}}();e=a;g["default"]=e}),98);
__d("MAWSetupBridge",["LSDatabaseSingleton","LSInitSyncCompleteSubscription","MAWBridgeUIEventHandler","MAWCommonSetupBridge","MAWCryptoAuthToken","MAWMainThreadLogger","MAWSetupBridgeOfflineSnapshot","Run","Visibility","asyncToGeneratorRuntime","cr:1265","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ArmadilloCutoverClientFalcoEvent").__setRef("MAWSetupBridge"),i=c("requireDeferred")("MAWSetupBridgeOfflineConsumer").__setRef("MAWSetupBridge"),j=c("LSDatabaseSingleton").then(d("LSInitSyncCompleteSubscription").use).then(function(){return c("LSDatabaseSingleton")}),k=function(a){h.loadImmediately(function(b){b=b.log;return b(function(){return{armadillo_thread_id:a.armadilloThreadId,domain:a.domain,event:a.event,event_details:a.eventDetails,open_thread_id:a.openThreadId,success:a.success,trace_id:a.traceId}})})};function a(a){var e=a.dispatch,f=a.environment,g=a.logout,h=a.reregisterDevice,l=a.worker;function m(){l.postMessage({type:"force-flush-data"})}d("Run").onUnload(m);d("Run").onBeforeUnload(m,!1);c("Visibility").addListener(c("Visibility").HIDDEN,function(){l.postMessage({type:"force-flush-logs-only"})});return d("MAWCommonSetupBridge").initBridge({customizeEventHandlers:{flushLogs:function(a){return d("MAWMainThreadLogger").logToHistoryInBulk(a.logs)},logCutoverEvent:k,logout:g,offlineConsumerProgress:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield i.load())(j,e).apply(void 0,arguments)});function c(){return a.apply(this,arguments)}return c}(),offlineSnapshot:c("MAWSetupBridgeOfflineSnapshot"),reregisterDevice:h,rotateCryptoAuthToken:function(){return d("MAWCryptoAuthToken").fetchFreshCAT(f)},uiUpdate:function(a){a=a.events;e&&a.forEach(function(a){return e(a)});b("cr:1265")==null?void 0:b("cr:1265").recordBridgeUIEvent(a);d("MAWBridgeUIEventHandler").handleEvents(j,a)}},worker:l})}g.setupBridge=a}),98);
__d("useMWEncryptedBackupsProcessBackupIdsDeferred",["gkx","react","requireDeferred","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect,i=c("requireDeferred")("MWEncryptedBackupsProcessBackupIds.bs").__setRef("useMWEncryptedBackupsProcessBackupIdsDeferred");function a(a){var b=c("useReStore")();h(function(){if(c("gkx")("5448")){var d,e=!1;i.onReadyImmediately(function(c){e||(d=c.subscribeToEncryptedBackupsRow(b,a))});return function(){e=!0,d==null?void 0:d()}}else{var f=function(){};i.onReady(function(c){f=c.subscribeToEncryptedBackupsRow(b,a)});return f}},[b,a])}g["default"]=a}),98);
__d("MAWCommonSetup",["CometRelay","InteractionTracingMetrics","MAWBridge","MAWBridgeFireAndForget","MAWCommonBackendSetup","MAWEncryptedBackupsStateManager","MAWInit","MAWIssueNewUserVisibleErrors","MAWJobDefinitions","MAWLogMultipleTabs","MAWSetupBridge","MAWStateContext.react","MAWTTRC","MAWTTRCSafe","MAWUIJob","MAWWaitForBackendSetup","MWChatInteraction.bs","Promise","WAJobOrchestratorTypes","asyncToGeneratorRuntime","getErrorSafe","promiseDone","react","requireDeferred","useMWEncryptedBackupsProcessBackupIdsDeferred"],(function(a,b,c,d,e,f,g){"use strict";e=d("react");var h=e.useContext,i=e.useEffect,j=c("requireDeferred")("FBLogger").__setRef("MAWCommonSetup"),k=!1,l=function(a){d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a),d("MAWBridgeFireAndForget").fireAndForget("backend","setEncryptedBackupsState",{newState:a})};function a(a){var b=d("CometRelay").useRelayEnvironment(),e=h(d("MAWStateContext.react").MAWStateContext),f=e.dispatch;i(function(){c("promiseDone")(p(b,a,f))},[b,a,f]);c("useMWEncryptedBackupsProcessBackupIdsDeferred")(l)}var m,n=new(b("Promise"))(function(a){m=function(c){a(c),c.onmessage=function(a){return o.onmessage==null?void 0:o.onmessage(a)},m=function(a){a.onmessage=function(a){return o.onmessage==null?void 0:o.onmessage(a)},n=b("Promise").resolve(a)}}}),o={onmessage:null,postMessage:function(a){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield n);b.postMessage(a)})())}};function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(k)return;k=!0;d("MAWTTRC").startMAWTTRCFlow();try{d("MAWIssueNewUserVisibleErrors").deleteAllErrors();var f=b.logout,g=b.reregisterDevice;yield d("MAWCommonBackendSetup").setupArmadilloBackend(b.getOrSetupWorker,d("MAWInit").MAWInit,function(b){var h={close:function(){},onmessage:null,postMessage:function(a){return b.postMessage(a)}},i={close:function(){return b.close()},onmessage:null,postMessage:function(a){return b.postMessage(a)}};m==null?void 0:m(h);b.onmessage=function(a){h.onmessage==null?void 0:h.onmessage(a),i.onmessage==null?void 0:i.onmessage(a)};c("promiseDone")(d("MAWSetupBridge").setupBridge({dispatch:e,environment:a,logout:f,reregisterDevice:g,worker:i}))});d("MAWUIJob").UIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.handleFutureproofMsg({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}));d("MAWInit").MAWInit.endSuccess();c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("backend","getSecureThreadTotalCount"),function(a){d("MAWTTRCSafe").addIntAnnotation("totalSecureThreadCount",a);var b=d("MWChatInteraction.bs").get(d("MWChatInteraction.bs").MW_AUTO_CHAT_TAB_OPEN);b!=null&&(c("InteractionTracingMetrics").addAnnotationInt(b,"totalSecureThreadCount",a),d("MAWLogMultipleTabs").addAnnotationWithInteractionUuid(b))});d("MAWWaitForBackendSetup").resolveBackendSetup()}catch(a){var h=a,i="failure_during_armadillo_backend_setup";if(h instanceof d("MAWInit").MAWInitError){h=c("getErrorSafe")((b=h.error)!=null?b:a);i=(b=h.message)!=null?b:"Error: MAWInitError without message."}else{h=c("getErrorSafe")(a);i=((b=(b=h)==null?void 0:b.name)!=null?b:"Error")+": "+((b=(b=h)==null?void 0:b.message)!=null?b:"Unknown")}b=i==="maw_appmutex_no_permission"&&document.visibilityState!=="visible";b?d("MAWInit").MAWInit.cancel(i):(d("MAWWaitForBackendSetup").rejectBackendSetup(a),d("MAWInit").MAWInit.fail(i));d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER,i);void j.load().then(function(a){return a("messenger_e2ee_web").catching(h).mustfix("MAW backend setup failed -- %s",i)});throw h}});return q.apply(this,arguments)}g.useArmadillo=a;g.workerProxy=o}),98);
__d("MAWSetupMutex",["FBLogger","LocalStorageMutex","MAWAppMutex","MAWBridge","MAWClientConsistencyRefresh","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWReinitWorker","MAWStateContext.react","MAWTTRC","MAWWaitForBackendSetup","QPLUserFlow","Run","WALoggerDeferred","asyncToGeneratorRuntime","gkx","qex","qpl","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Shouldn't reinitialize, shared worker is active on a different tab"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Shouldn't reinitialize, worker already exists"]);i=function(){return a};return a}a=d("react");var j=a.useCallback,k=a.useEffect,l=a.useMemo,m=c("FBLogger")("messenger_e2ee_web"),n=!1,o=0;function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(document.visibilityState!=="visible")return!1;a=a();var f=window.indexedDB!=null,g=d("MAWLocalStorage").isLocalStorageAvailable();if(a){void d("WALoggerDeferred").DEV(i());return!1}if(!f||!g)return!1;if(yield b()){void d("WALoggerDeferred").DEV(h());c("MAWClientConsistencyRefresh")("worker_mismatch");e();return!1}return!0});return q.apply(this,arguments)}e=function(a,e,f){var g=e.doesWorkerExist,h=e.getOrSetupWorker,i=e.isSharedWorkerActive,q=e.logout,r=e.reregisterDevice,s=e.setupBridge,t=e.terminateWorker,u=e.terminateWorkerPermanently,v=l(function(){return d("MAWAppMutex").use()},[]),w=c("useReStore")(),x=d("MAWStateContext.react").useDispatchClearEphemeralSettings(),y=w.persistenceTypes.includes("indexeddb"),z=j(function(a){var b=v.takeoverFilter(a);if(!b||a.newValue===d("LocalStorageMutex").THIS_TAB||a.newValue==="")return;y||d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"DropAllSecureThreads",value:void 0}]});t("MAWSetupMutexV2:handleStoreChange");d("MAWWaitForBackendSetup").resetBackendSetup();c("gkx")("4146")?(d("MAWTTRC").addBoolAnnotation("workerMutexLost",!0),d("MAWInit").MAWInit.addBoolAnnotation("workerMutexLost",!0)):c("gkx")("5928")&&(d("MAWTTRC").fail("mutex_lost"),d("MAWInit").MAWInit.fail("mutex_lost"));v.onMutexDeath()},[v,y,t]),A=j(function(){t("MAWSetupMutexV2:handleUnload"),v.onMutexDeath()},[v,t]),B=j(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield p(g,i,u));if(!b||n||c("qex")._("215")===!0)return;n=!0;o++;try{yield c("MAWReinitWorker")({allTablesPersisted:y,db:w,dispatch:f,dispatchClearEphemeralSettings:x,environment:a,getOrSetupWorker:h,instanceKey:o,logout:q,reregisterDevice:r,setupBridge:s}),d("MAWWaitForBackendSetup").resolveBackendSetup(),d("MAWIssueNewUserVisibleErrors").deleteUserVisibleErrorByJSErrorMessage("maw_appmutex_no_permission")}catch(a){m.mustfix("AppMutex - failed to reinitialize worker: "+a.message.concat(" (",a.error,")")),m.catching(a),c("QPLUserFlow").endFailure(c("qpl")._(25310984,"169"),"failed_to_reinitialize_worker",{annotations:{string:{error:a.message.concat(": ",a.error)}},error:a,instanceKey:o})}finally{n=!1}}),[y,w,f,x,g,a,h,i,q,r,s,u]);k(function(){window.addEventListener("storage",z);var a=d("Run").onBeforeUnload(A,!1),b=d("Run").onUnload(A);window.addEventListener("visibilitychange",B);return function(){window.removeEventListener("storage",z),a.remove(),b.remove(),window.removeEventListener("visibilitychange",B)}},[z,A,B])};g.useMutex=e}),98);
__d("MAWSetupMutex.react",["MAWSetupMutex","react"],(function(a,b,c,d,e,f,g){"use strict";d("react");function a(a){var b=a.dispatch,c=a.environment;a=a.platformSetupUtils;d("MAWSetupMutex").useMutex(c,a,b);return null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatFetchThreadMessageCounts",["I64","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c={},e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("threads")).filter(function(a){return d("I64").to_int32(a.threadType)===16||d("I64").to_int32(a.threadType)===15}).map(function(a){return a.threadKey}))),f=(yield b("Promise").all(e.map(function(b){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("messages")).getKeyRange(b).filter(function(a){return!a.isAdminMessage}))})));e.forEach(function(a,b){c[d("I64").to_string(a)]=f[b].length});return c});return h.apply(this,arguments)}function c(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("messages")).getKeyRange(b).filter(function(a){return!a.isAdminMessage})));return a.length});return i.apply(this,arguments)}g.fetchArmadilloThreadMessageCounts=a;g.fetchArmadilloThreadMessageCount=c}),98);
__d("MWChatDataLossCheckerUtil",["Crypto.bs","FBLogger","I64","LSDatabaseSingleton","MAWBridgeSendAndReceive","MAWMiActOnActThreadReady","MWChatFetchThreadMessageCounts","Promise","QuickPerformanceLogger","WebStorage","asyncToGeneratorRuntime","gkx","promiseDone","qex","qpl","useDataLossStatisticsStorageListener"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=Array.from(new Uint8Array(a));return a.map(function(a){return a.toString(16).padStart(2,"0")}).join("")}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(c("qex")._("460"))return a;var b=new TextEncoder();b=b.encode(a).buffer;a=(yield d("Crypto.bs").digest("SHA-256",b));return h(a)}catch(a){return a}});return j.apply(this,arguments)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.currentIDBCnt,d=a.currentMsgCnt,e=a.logThreadId,f=a.prevMsgCnt,g=a.qplEvent;a=a.threadId;if(e!=null&&e){e=(yield i(a));b!=null?(c("QuickPerformanceLogger").markerStartFromNavStart(g),c("QuickPerformanceLogger").markerAnnotate(g,{"int":{current_idb_count:b,current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),c("QuickPerformanceLogger").markerEnd(g,2)):(c("QuickPerformanceLogger").markerStartFromNavStart(g),c("QuickPerformanceLogger").markerAnnotate(g,{"int":{current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),c("QuickPerformanceLogger").markerEnd(g,2))}else b!=null?(c("QuickPerformanceLogger").markerStartFromNavStart(g),c("QuickPerformanceLogger").markerAnnotate(g,{"int":{current_idb_count:b,current_msg_count:d,prev_msg_count:f}}),c("QuickPerformanceLogger").markerEnd(g,2)):(c("QuickPerformanceLogger").markerStartFromNavStart(g),c("QuickPerformanceLogger").markerAnnotate(g,{"int":{current_msg_count:d,prev_msg_count:f}}),c("QuickPerformanceLogger").markerEnd(g,2))});return l.apply(this,arguments)}function m(a){var b=a.currentMsgCnt,e=a.logThreadId,f=a.prevMsgCnt,g=a.qplEvent,h=a.threadId;return!c("gkx")("7965")?k({currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h}):c("LSDatabaseSingleton").then(function(a){return d("MAWMiActOnActThreadReady").onActThreadReady(a,d("I64").of_string(h),"MWChatDataLossCheckerUtil",function(a,i,j){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","fetchArmadilloThreadMessageCount",{threadId:i}).then(function(a){return k({currentIDBCnt:a,currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h})})["catch"](function(a){c("FBLogger")("labyrinth").catching(a).warn("Failed to fetch IndexDB message count");return k({currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h})})})})}function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{a=(yield d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCount(a,b));var e=c("WebStorage").getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return{isThreadMissingMessages:!1};e=JSON.parse(e);b=(e=e[d("I64").to_string(b)])!=null?e:null;if(b==null)return{isThreadMissingMessages:!1};return b>0&&a===0?{currCount:a,isThreadMissingMessages:!0,prevCount:b}:{isThreadMissingMessages:!1}}catch(a){c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss");return{isThreadMissingMessages:!1}}});return n.apply(this,arguments)}function e(a){a=d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a);a.then(function(a){var e=c("WebStorage").getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return b("Promise").resolve(null);e=JSON.parse(e);return b("Promise").resolve({current:a,previous:e})}).then(function(a){if(a==null)return b("Promise").resolve();var c=a.current;a=a.previous;return o(a,c)})["catch"](function(a){return c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss")});return a.then(function(){})}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d){var e=[];for(var f in a)Object.prototype.hasOwnProperty.call(d,f)&&e.push(f);f=[];for(var g=0;g<e.length;g++){var h=e[g],i={currentMsgCnt:d[h],prevMsgCnt:a[h],threadId:h};a[h]>0&&d[h]===0?(f.push(m(babelHelpers["extends"]({},i,{qplEvent:c("qpl")._(717553665,"1183")}))),f.push(m(babelHelpers["extends"]({},i,{logThreadId:!0,qplEvent:c("qpl")._(717562243,"1358")})))):(f.push(m(babelHelpers["extends"]({},i,{qplEvent:c("qpl")._(717553666,"1184")}))),f.push(m(babelHelpers["extends"]({},i,{logThreadId:!0,qplEvent:c("qpl")._(717556541,"1361")}))))}yield b("Promise").all(f)});return p.apply(this,arguments)}function f(a){var b=function(b){c("promiseDone")(i(b).then(function(d){c("QuickPerformanceLogger").markerStartFromNavStart(c("qpl")._(717567419,"1383")),c("QuickPerformanceLogger").markerAnnotate(c("qpl")._(717567419,"1383"),{string:{encryptedThreadId:d,msg_count:a[b].toString()}}),c("QuickPerformanceLogger").markerEnd(c("qpl")._(717567419,"1383"),2)}))};for(var d in a)b(d)}g.qplLog=m;g.checkIsThreadMissingMessages=a;g.fetchCountsAndLogDataLoss=e;g.logThreadCompleteDataLoss=o;g.logLocalStatistics=f}),98);
__d("useDataLossStatisticsStorageListener",["LSDatabaseSingleton","MWChatDataLossCheckerUtil","MWChatFetchThreadMessageCounts","Visibility","WebStorage","promiseDone","qex","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect,i="armadillo_msgr_data_loss_stats";function a(){h(function(){var a;window.setTimeout(function(){a=c("Visibility").addListener(c("Visibility").HIDDEN,function(){c("promiseDone")(c("LSDatabaseSingleton").then(function(a){return d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a).then(function(a){c("WebStorage").setItemGuarded(c("WebStorage").getLocalStorage(),i,JSON.stringify(a)),c("qex")._("1259")&&d("MWChatDataLossCheckerUtil").logLocalStatistics(a)})}))})},3e4);return function(){var b;(b=a)==null?void 0:b.remove()}},[])}g.DATA_LOSS_STATISTICS_STORAGE_KEY=i;g.useDataLossStatisticsStorageListener=a}),98);
__d("useOnMawSetupComplete.react",["promiseDone","react","waitForMAWTTRC"],(function(a,b,c,d,e,f,g){"use strict";b=d("react");var h=b.useEffect,i=b.useState;function j(a,b){h(function(){var b=!1;c("promiseDone")(d("waitForMAWTTRC").promise.then(function(){if(b)return;a()}));return function(){b=!0}},b)}function a(){var a=i(!1),b=a[0],c=a[1];j(function(){return c(!0)},[]);return b}g.useOnMawSetupComplete=j;g.useIsMAWSetupComplete=a}),98);
__d("useDataLossChecker",["LSDatabaseSingleton","MWChatDataLossCheckerUtil","asyncToGeneratorRuntime","cr:3504","promiseDone","useDataLossStatisticsStorageListener","useOnMawSetupComplete.react"],(function(a,b,c,d,e,f,g){"use strict";function a(){d("useDataLossStatisticsStorageListener").useDataLossStatisticsStorageListener(),d("useOnMawSetupComplete.react").useOnMawSetupComplete(function(){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){b("cr:3504")==null?void 0:b("cr:3504").logMAWDBUsageMetrics();var a=(yield c("LSDatabaseSingleton"));return a.runInTransaction(function(a){return d("MWChatDataLossCheckerUtil").fetchCountsAndLogDataLoss(a)},"readwrite")})())},[])}g["default"]=a}),98);
__d("useLegacyUserWatchdog",["MAWIssueNewUserVisibleErrors","clearTimeout","react","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect;b=24*60*60*1e3;var i=5*b;function a(){h(function(){var a=c("setTimeout")(function(){d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)},i);return function(){return c("clearTimeout")(a)}})}g["default"]=a}),98);
__d("useMAWContactSync",["I64","JSScheduler","LSAuthorityLevel","LSContactBitOffset","LSContactBlockedByViewerStatus","LSDatabaseSingleton","LSInitSyncCompleteSubscription","LSIntEnum","MAWBridgeFireAndForget","MAWContactRelationshipType","Promise","ReQL","asyncToGeneratorRuntime","debounceCore","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect;function a(){h(function(){var a=new(b("Promise"))(function(a){c("JSScheduler").scheduleSpeculativeCallback(function(){c("promiseDone")(c("LSDatabaseSingleton").then(function(b){return i(b).then(function(a){return l(a)}).then(function(){return j(b)}).then(function(b){return a(b)})}))})});return function(){c("promiseDone")(a.then(function(a){return a()}))}},[])}function i(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("contacts")).filter(function(a){return d("I64").to_int32(a.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE}))}function j(a){return d("ReQL").fromTableAscending(a.table("contacts")).subscribe(n)}var k=!1;function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(k===!0)return;k=!0;yield d("LSInitSyncCompleteSubscription").use;yield d("MAWBridgeFireAndForget").fireAndForget("backend","updateContacts",{contacts:a.map(o)})});return m.apply(this,arguments)}function n(a,b){if(b.operation==="delete")return;b=b.value;p.set(a,b);q()}function o(a){var b;b=(b=d("LSContactBitOffset").has(d("LSIntEnum").ofNumber(66),a))!=null?b:!1;return{fbid:d("I64").to_string(a.id),isBlocked:!d("I64").equal(a.blockedByViewerStatus,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED)),isRestricted:b,name:a.name,relationship:d("MAWContactRelationshipType").getContactRelationshipType(a)}}var p=new Map(),q=c("debounceCore")(function(){d("MAWBridgeFireAndForget").fireAndForget("backend","updateContacts",{contacts:Array.from(p.values()).map(o)}),p.clear()},1e3);g.useMAWContactSync=a}),98);
__d("useMAWReregisterDeviceOnError",["LSPersistedDbGating","MAWBridgeSendAndReceive","MAWIssueNewUserVisibleErrors","MAWReinitWorker","MAWSetupWorker","MAWStateContext.react","ODS","WATagsLogger","asyncToGeneratorRuntime","react","shouldUseMAWSharedWorker","useReStore"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to reinit worker ",""]);h=function(){return a};return a}e=d("react");var i=e.useCallback,j=e.useContext,k=!1,l=typeof window!=="undefined"?window:self;function m(){k=!0,d("MAWSetupWorker").terminateWorkerPermanently(),d("ODS").bumpEntityKey(3185,"armadillo_forced_reregister_fail",l.location.hostname),d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}function a(a,e){var f=e.getOrSetupWorker,g=e.setupBridge,n=e.terminateWorker,o=c("useReStore")(),p=d("MAWStateContext.react").useDispatchClearEphemeralSettings();e=j(d("MAWStateContext.react").MAWStateContext);var q=e.dispatch;return i(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(k)return;d("ODS").bumpEntityKey(3185,"armadillo_forced_deregister",l.location.hostname);yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","removeCurrentDevice");var b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();b&&(yield d("MAWSetupWorker").killSharedWorker());n("useMAWReregisterDeviceOnError");try{yield c("MAWReinitWorker")({allTablesPersisted:d("LSPersistedDbGating").allTablesPersisted,db:o,dispatch:q,dispatchClearEphemeralSettings:p,environment:a,getOrSetupWorker:f,logout:m,reregisterDevice:m,setupBridge:g})}catch(a){d("WATagsLogger").TAGS(["LogoutHandler"]).ERROR(h(),a),d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}}),[n,o,q,p,a,f,g])}g["default"]=a}),98);
__d("MAWSetupImpl.react",["BaseHeadingContext","CometRelay","MAWCommonSetup","MAWSetupMutex.react","MAWSetupWorker","MAWStateContext.react","MAWWebWorkerInstance","cr:2808","cr:2809","cr:6470","promiseDone","react","shouldUseMAWSharedWorker","useDataLossChecker","useLegacyUserWatchdog","useMAWContactSync","useMAWReregisterDeviceOnError"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");e=d("react");var i=e.useContext,j=e.useEffect,k=e.useMemo;window.XPlatTesting=b("cr:2808");window.XPlatTestingGroups=b("cr:2809");function a(a){var e=a.children,f=a.fbid,g=a.logout,l=a.setupBridge;a=i(d("MAWStateContext.react").MAWStateContext);a=a.dispatch;var m=d("CometRelay").useRelayEnvironment(),n=c("useMAWReregisterDeviceOnError")(m,{doesWorkerExist:d("MAWWebWorkerInstance").doesWorkerExist,getOrSetupWorker:d("MAWSetupWorker").getOrSetupWorker,isSharedWorkerActive:d("MAWSetupWorker").isSharedWorkerActive,setupBridge:l,terminateWorker:d("MAWSetupWorker").terminateWorker,terminateWorkerPermanently:d("MAWSetupWorker").terminateWorkerPermanently}),o=k(function(){return{doesWorkerExist:d("MAWWebWorkerInstance").doesWorkerExist,getOrSetupWorker:d("MAWSetupWorker").getOrSetupWorker,isSharedWorkerActive:d("MAWSetupWorker").isSharedWorkerActive,logout:g!=null?g:function(){return c("promiseDone")(n())},reregisterDevice:function(){return c("promiseDone")(n())},setupBridge:l,terminateWorker:d("MAWSetupWorker").terminateWorker,terminateWorkerPermanently:d("MAWSetupWorker").terminateWorkerPermanently}},[g,n,l]);d("MAWCommonSetup").useArmadillo(o);d("useMAWContactSync").useMAWContactSync();c("useLegacyUserWatchdog")();c("useDataLossChecker")();b("cr:6470")==null?void 0:b("cr:6470")();j(function(){d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker()});var p=i(c("BaseHeadingContext")),q=!d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();return h.jsxs(c("BaseHeadingContext").Provider,{value:p+1,children:[e,q?h.jsx(c("MAWSetupMutex.react"),{dispatch:a,environment:m,fbId:f,platformSetupUtils:o}):null]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);